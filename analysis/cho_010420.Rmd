---
title: "Carbohydrate Drinks"
date: "`r format(Sys.time(), '%d %B, %Y (%H:%M)')`"
output:
  html_document:
    font: Source Sans Pro
    theme: cosmo
    anchor_sections: TRUE
    toc_float: 
      collapsed: FALSE
      smooth_scroll: TRUE
    toc_depth: 4
    linkcolor: blue
  latex_engine: xelatex
  pdf_document:
    toc: yes
    toc_depth: '3'
bibliography: cho.bib
csl: jama.csl
link-citations: yes
workflowr:
  suppress_report: false
nocite: '@*'
---

#### 

```{=html}
<style type="text/css">
  body{
  font-size: 9.5pt;
  font-family: Source Sans Pro;
}

.list-group-item.active, .list-group-item.active:hover, .list-group-item.active:focus {
  color: #090909;
  background-color: #0909093d;
}

.lightable-classic.lightable-hover tbody tr:hover {
    background-color: #c5d4e4;
}
.btn-xs, .btn-group-xs>.btn { 
display: none; 
}

.btn-default {
display: none !important; 
}
</style>
```

```{r setupData, include = FALSE}
## (updated 2021/01/06 11:34) preliminaries -------------------------------
# functions
now <- function() {str_replace_all(format(Sys.time(), "%m %d %y_%H-%M"), " ", "_")}
m_table <- function(data, x){
  group_by(data, arm_tx) %>%
    summarise(tx_count = n())
}
# replace_mg <- function(a, b) {if_else(is.na(a) & !is.na(b), b, a)}
tab_inc <- function() {
  table_n <- table_n + 1
  table_n}
fig_inc <- function() {
  figure_n <- figure_n + 1
  figure_n}
table_n <- 1
figure_n <- 1

## get current files; select cho refids; directory must have unique ####
source("code/readFiles_120220_wfr.R")

# add study protein indicator "tx"
study_char.dat <- left_join(study_char.dat, cho_refids, by = "refid") 
study_arm.dat  <- left_join(study_arm.dat, cho_refids, by = "refid") 

# study char protein refs 
study_char_cho.dat <- study_char.dat %>% 
  filter(tx %in% c("protein", "cho", "cho/protein")) 

# study arm protein refs 
study_arm_cho.dat <- study_arm.dat %>% 
  filter(tx %in% c("protein", "cho", "cho/protein")) %>% 
  # remove duplicate arms tewari 2019 (refid 716)
  filter(!(refid == 716 & arm_n == 8)) %>% 
  mutate(study = ifelse(refid == 2564 & grepl("colorectal", notes_arm), paste(study, "(cr)"), study),
         study = ifelse(refid == 2564 & grepl("cholecystectomy", notes_arm), paste(study, "(ch)"), study),
         study = ifelse(refid == 1926 & grepl("general", notes_arm), paste(study, "(gen)"), study),
         study = ifelse(refid == 1926 & grepl("epidural", notes_arm), paste(study, "(epi)"), study)) %>% 
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "placebo",
    "other_clear",
    "other",
    "milk",
    "protein",
    "cho"))) %>%
  mutate(tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Placebo = "placebo",
    Clear = "other_clear",
    Other = "other",
    Milk = "milk",
    "CHO/Prot" = "protein",
    CHO = "cho"),
    arm_tx = tx) %>%
  select(-tx)

# tewari 2019
study_arm_cho_tewari.dat <- study_arm.dat %>% 
  filter(tx %in% c("protein", "cho", "cho/protein")) %>% 
  filter(refid == 716)

## dichot factor treatment arm outcome type for ordering (updated 2020/12/12 12:04) ####
# save dichot.dat 
dichot_all.dat <- dichot.dat
# dichot.dat <- dichot_all.dat
dichot.dat <- dichot.dat %>% 
  filter(refid %in% cho_refids$refid) %>% 
  # factor arm_tx levels for cho studies
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "placebo",
    "other_clear",
    "other",
    "milk",
    "protein",
    "cho"))) %>%
  mutate(tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Placebo = "placebo",
    Clear = "other_clear",
    Other = "other",
    Milk = "milk",
    "CHO/Prot" = "protein",
    CHO = "cho"),
    arm_tx = tx) %>%
  select(-tx)

m_table(dichot.dat, arm_tx)

## contin factor treatment arm outcome type for ordering (updated 2020/12/12 12:04) ####
# save contin.dat
# contin_all.dat <- contin.dat
# contin.dat <- contin_all.dat
contin.dat <- contin.dat %>% 
  filter(refid %in% cho_refids$refid) %>% 
  # factor arm_tx levels for cho studies
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "placebo",
    "other_clear",
    "other",
    "milk",
    "protein",
    "cho"))) %>%
  mutate(tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Placebo = "placebo",
    Clear = "other_clear",
    Other = "other",
    Milk = "milk",
    "CHO/Prot" = "protein",
    CHO = "cho"),
    arm_tx = tx) %>%
  select(-tx)

m_table(contin.dat, arm_tx)

## likert factor treatment arm outcome type for ordering (updated 2020/12/12 12:04) ####
# save likert
likert_all.dat <- likert.dat
# likert.dat <- likert_all.dat
likert.dat <- likert.dat %>% 
  filter(refid %in% cho_refids$refid) %>% 
  # factor arm_tx levels for cho studies
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "placebo",
    "other_clear",
    "other",
    "milk",
    "protein",
    "cho"))) %>%
  mutate(tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Placebo = "placebo",
    Clear = "other_clear",
    Other = "other",
    Milk = "milk",
    "CHO/Prot" = "protein",
    CHO = "cho"),
    arm_tx = tx) %>%
  select(-tx)

m_table(likert.dat, arm_tx)

## divide Sada 2014 into 2 studies ---------------------------------------------------------------
likert.dat <- likert.dat %>% 
  mutate(study = ifelse(study == "Sada 2014" & arm %in% c(1,2,6), "Sada 2014 (CH)", study),
         study = ifelse(study == "Sada 2014" & !arm %in% c(1,2,6), "Sada 2014 (CR)", study))

contin.dat <- contin.dat %>% 
  mutate(study = ifelse(study == "Sada 2014" & arm %in% c(1,2,6), "Sada 2014 (CH)", study),
         study = ifelse(study == "Sada 2014" & !arm %in% c(1,2,6), "Sada 2014 (CR)", study))

dichot.dat <- dichot.dat %>% 
  mutate(study = ifelse(study == "Sada 2014" & arm %in% c(1,2,6), "Sada 2014 (CH)", study),
         study = ifelse(study == "Sada 2014" & !arm %in% c(1,2,6), "Sada 2014 (CR)", study))

```

# Included Studies 

<br>

<font size = 4> Table `r table_n`. Number of included studies according to age, surgery, and design. </font>


```{r studiesIncluded, include = FALSE, echo = FALSE}
## (updated 2021/01/05 09:15) Included Studies ----------------------------
# list of studies, age, surgical/non surgical, design 
study_char_cho.dat %>%
  group_by(age, surg_nosurg, design, .groups = "drop")  %>%
  summarise(total = n()) %>%
  ungroup() %>%
  arrange(age, desc(surg_nosurg), design) %>%
  group_by(age, surg_nosurg, .groups = "drop") %>%
  mutate(row = row_number()) %>%
  ungroup() %>%
  janitor::adorn_totals("row") %>%
mutate(
    age = ifelse(row != 1, NA, age),
    surg_nosurg = ifelse(row != 1, NA, surg_nosurg)) %>%
  select(age, surg_nosurg, design, total) %>%
  mutate(
    surg_nosurg = firstup(surg_nosurg),
    design = case_when(
      design == "rct" ~ "RCT",
      design == "crossover" ~ "Crossover",
      design == "cluster" ~ "Cluster",
      design == "nrsi" ~ "Nonrandomized",
      design == "prospect_coh" ~ "Prospective Cohort",
      design == "retrospect_coh" ~ "Retrospective Cohort",
      design == "casecontrol" ~ "Case-control",
      design == "other" ~ "Before-after")) %>% 
  kbl(
    booktabs = T, align = c("lllr"),
    col.names = c("\\ \\ \\ \\ \\ \\ \\ \\ Age", "Patients", "Design", "N")) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>%
  kable_styling(bootstrap_options = opt_boot)

table_n <- tab_inc()
```

```{r}
study_char_cho.dat %>%
  select(age, design, surg_nosurg) %>% 
  tabyl(design, surg_nosurg, age) %>% 
  adorn_totals("row") %>% 
  data.frame() %>% 
  as_tibble() %>% 
  select(c(1:3,5,6)) %>% 
  `colnames<-`(c("design", "nonsurg_adult", "surg_adult",  "nonsurg_peds", "surg_peds")) %>% 
  select(design, surg_adult, nonsurg_adult, surg_peds, nonsurg_peds) %>% 
  filter(!design %in% c("case_series", "cluster")) %>% 
  mutate(
    design = case_when(
      design == "rct" ~ "RCT",
      design == "crossover" ~ "Crossover",
      design == "cluster" ~ "Cluster",
      design == "nrsi" ~ "Nonrandomized",
      design == "prospect_coh" ~ "Prospective Cohort",
      design == "retrospect_coh" ~ "Retrospective Cohort",
      design == "casecontrol" ~ "Case-control",
      design == "other" ~ "Before-after",
      design == "Total" ~ "Total")) %>% 
  kbl(
    booktabs = T, align = c("lcccc"), col.names = c("Design", "Surgical", "Non-surgical", "Surgical", "Non-surgical")) %>%
  add_header_above(c(" " = 1, "Adult" = 2, "Pediatric" = 2), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "12em") %>%  
  column_spec(c(2:5), width = "8em") %>% 
  row_spec(8, bold = TRUE)
  
```

<br>

<font size = 4> Table `r table_n`. List of included studies according to age, surgery, and design (see [References](#references) for citations). </font>

```{r studiesIncludedList, echo = FALSE, include = TRUE}
## (updated 2021/01/12 09:23) studiesIncludedList -------------------------
study_char_cho.dat %>%
  select(refid, study, year, age, surg_nosurg, design, n_analyze, country, centers, non_vh_hdi, surg_type) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  mutate(surg = case_when(
      str_detect(surg_type, "[Gg]yn|[Hh]ysterectomy") ~ "Gyn",
      str_detect(surg_type, "craniotomy") ~ "Neurosurgical",
      str_detect(surg_type, "maxillofacial") ~ "Maxillofacial",
      str_detect(surg_type, "[Hh]ernia|herniorrhaphy") ~ "Herniorrhaphy",
      str_detect(surg_type, "prostatectomy") ~ "prostatectomy",
      str_detect(surg_type, "ariety") ~ "Various",
      str_detect(surg_type, "various|Hirschsprung's") ~ "Various",
      str_detect(surg_type, "CABG|[Cc]oronary artery bypass surgery") ~ "CABG",
      str_detect(surg_type, "[Cc]olorectal|[Bb]owel|colon resection") ~ "Colorectal",
      str_detect(surg_type, "[Tt]hyroid|hip joint") ~ "Thyroid",
      str_detect(surg_type, "[Oo]rthopedic|discectomy") ~ "Orthopedic",
      str_detect(surg_type, "total hip or total knee replacement|[Tt]otal hip|[Tt]otal knee|Hip joint|hip replacement") ~ "TKA/THA",
      str_detect(surg_type, "cholecystectomy") ~ "Cholecystectomy",
      str_detect(surg_type, "[Gg]ast|Bowel") ~ "Other GI",
      str_detect(surg_type, "not appli") ~ "None (healthy)",
      str_detect(surg_type, "oral") ~ "Oral",
      str_detect(surg_type, "minor") ~ "Misc minor",
      str_detect(surg_type, "None") ~ "None (healthy)",
      str_detect(surg_type, "abdomin") ~ "Other GI",
      str_detect(surg_type, "[Cc]esarean|labor") ~ "Cesarean/vaginal birth",
      str_detect(surg_type, "thoracotomy") ~ "Thoracic",
      str_detect(surg_type, "healthy") ~ "None (healthy)",
      str_detect(surg_type, "Elective") ~ "Elective",
      str_detect(surg_type, "adenotonsillectomy") ~ "Adenotonsillectomy",
      str_detect(surg_type, "[Bb]reast") ~ "Breast",
      str_detect(surg_type, "Endso|endoscopic|colonoscopy") ~ "Endoscopic")) %>%
  mutate(
    surg_nosurg = ifelse(surg_nosurg == "non-surgical", "None", surg_nosurg),
    study = ifelse(grepl("Marquini", study), str_c(study, "^b^"), study),
    country = ifelse(grepl("USA", country), "USA", country),
    country = ifelse(grepl("UK", country), "UK", country),
    country = ifelse(!is.na(non_vh_hdi), str_c(country, "^a^"), country),
    n_analyze = ifelse(refid == 2009, 9, n_analyze)) %>%
  select(refid, study, n_analyze, centers, country, surg) %>%
  kbl(
    booktabs = T, align = c("llccll"), # format = "latex",
    col.names = c("\\ \\ \\ \\ \\ \\ \\ \\ ID", "Study", "Analyzed (N)", "Centers", "Country^a^", "Surgery")) %>%
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "6em") %>%  
  column_spec(2, width = "10em") %>%  
  column_spec(3, width = "6em") %>%  
  column_spec(4, width = "6em") %>%  
  column_spec(5, width = "10em") %>%  
  column_spec(6, width = "12em") %>%  
  pack_top(., "Adult, Surgical", 1, 92) %>%
  pack_sub(., "RCT", 1, 80) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 81, 89) %>%
  pack_sub(., "Prospective Cohort", 90, 91) %>%
  pack_sub(., "Retrospective Cohort", 92, 92) %>%
  pack_sub(., "Case-control", 93, 93) %>%
  pack_sub(., "Before-after", 94, 94) %>%
  pack_top(., "Adult, Non-surgical", 95, 107) %>%
  pack_sub(., "RCT", 95, 96) %>%
  pack_sub(., "Crossover", 97, 105) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 106, 107) %>%
  pack_top(., "Pediatric, Surgical", 108, 114) %>%
  pack_sub(., "RCT", 108, 112) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 113, 113) %>%
  pack_sub(., "Prospective Cohort", 114, 114) %>%
  pack_top(., "Pediatric, Non-surgical", 115, 117) %>%
  pack_sub(., "RCT", 115, 115) %>%
  pack_sub(., "Crossover", 116, 116) %>%
  pack_sub(., "Prospective Cohort", 117, 117) %>%
  footnote(
    alphabet = c(
      'Non very high [Human Development Index](https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index) country.'),
      "Multiple publications of the same study.",
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

```{r studiesIncludedPlain, echo = FALSE, include = FALSE}
## (updated 2021/01/05 09:15) Included Studies ----------------------------
# list of studies, age, surgical/non surgical, design 
study_char_cho.dat %>% 
  group_by(age, surg_nosurg, design) %>% 
  summarise(total = n()) %>% 
  ungroup()

study_char_cho.dat %>% 
  select(refid, study, year, age, surg_nosurg, design, n_analyze) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid, study, n_analyze, age, surg_nosurg, design) %>% 
  mutate(surg_nosurg = ifelse(surg_nosurg == "surgical", "Yes", "No"),
        study = ifelse(grepl("Marquini", study), str_c(study, "^a^"), study)) %>% 
         # n_analyze = ifelse(refid == 2009, 9, n_analyze),
         # study = ifelse(grepl("Marquini", study), str_c(study, "^a^"), study)) %>% 
  kbl(booktabs = T, align = c("llclll"), # format = "latex",
    col.names = c("\\ \\ \\ \\ \\ \\ \\ \\ ID", "Study", "Analyzed (N)", "Age", "Surgery", "Design")) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  pack_top(., "Adult, Surgical", 1, 92) %>% 
  pack_sub(., "RCT", 1, 80) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 81, 88) %>% 
  pack_sub(., "Prospective Cohort", 88, 89) %>%
  pack_sub(., "Retrospective Cohort", 90, 90) %>% 
  pack_sub(., "Case-control", 91, 91) %>% 
  pack_sub(., "Before-after", 92, 92) %>% 
  pack_top(., "Adult, Non-surgical", 93, 105) %>% 
  pack_sub(., "RCT", 93, 94) %>%
  pack_sub(., "Crossover", 95, 103) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 104, 105) %>% 
  pack_top(., "Pediatric, Surgical", 106, 112) %>% 
  pack_sub(., "RCT", 106, 110) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 111, 111) %>% 
  pack_sub(., "Prospective Cohort", 112, 112) %>% 
  pack_top(., "Pediatric, Non-surgical", 113, 115) %>% 
  pack_sub(., "RCT", 113, 113) %>%
  pack_sub(., "Crossover", 114, 114) %>%
  pack_sub(., "Prospective Cohort", 115, 115) %>% 
  footnote(alphabet = c("Multiple publications of the same study."),
    general_title = "", 
    footnote_as_chunk = FALSE)

# table_n <- tab_inc()
```

<br>

<hr style="height:2px;border-width:0;color:gray;background-color:gray">


# **Patient Reported Outcomes**
## Surgical/Endoscopy Studies

```{r dichotChoDataSurgical, include = FALSE}
## (updated 2021/01/12 09:26) dichotProtDataSurgical ----------------------
dichot_cho.dat <- dichot.dat %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6)) %>%  # Oyama PM
    # for nonsurgical
    # hr_0 = 0, hr_minus2 = 0,
    # hr_0 =      if_else(surg_nosurg != "surgical" & timeingest1 ==  0, amtingest1, hr_0, missing = 0),
    # hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest1 == -2, amtingest1, hr_minus2, missing = 0),
    # hr_0 =      if_else(surg_nosurg != "surgical" & timeingest2 ==  0, amtingest1, hr_0, missing = 0),
    # hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest2 == -2, amtingest1, hr_minus2, missing = 0)) %>% 
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  filter(surg_nosurg == "surgical") %>% 
  # select(refid, study, hr_2, hr_26, hr_gt6, timeingest1, amtingest1, timeingest2, amtingest2, age, design)
  mutate(
    hunger_np = n_percent(hunger_n, hunger_per),
    thirst_np = n_percent(thirst_n, thirst_per),
    nausea_np = n_percent(nausea_n, nausea_per),
    vomit_np = n_percent(vomit_n, vomit_per),
    comfort_np = n_percent(arm_n - comfort_n, 100 - comfort_per),
    satisfac_np = n_percent(satisfac_n, satisfac_per),
    complicate_np = n_percent(complicate_n, complicate_per),
    hypotension_np = n_percent(hypotension_n, hypotension_per),
    regurg_np = n_percent(regurg_n, regurg_per),
    rgv_gt25_np = n_percent(rgv_gt25_n, rgv_gt25_per),
    ph_lt25_np = n_percent(ph_lt25_n, ph_lt25_per),
    aspirate_np = n_percent(aspirate_n, aspirate_per),
    vomit_np = ifelse(refid == 6446 & arm_n == 40, "4 (10)", vomit_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx, arm) %>%
  select(refid, study, year, age, design, surg_nosurg, arm, arm_n, arm_tx, hr_gt6, hr_26, hr_2, time_outcome, hunger_np:aspirate_np, compl_descript, out_dichot_notes, ends_with("_n"), timeingest1, amtingest1, timeingest2, amtingest2, ends_with("per")) %>%
  filter_at(vars(hunger_np:aspirate_np), any_vars(!is.na(.)))

```

<br>

### Hunger

<br>

<font size = 4> Table `r table_n`. Comparative hunger ratings according to fasting, liquid and volume. </font>

```{r hungerTableOr, include = TRUE}
## (updated 2021/01/12 09:42) hungerTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_hunger_or <- dichot_cho.dat %>% 
  filter(!is.na(hunger_np)) %>%
  select(refid, study, arm_tx, arm_n, hunger_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_hunger <- with(or_join(dichot_hunger_or, "hunger"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))

```

```{r hungerTableDichot, include = TRUE}
## (updated 2021/01/12 18:04) hungerTable ---------------------------------
dichot_hunger <- dichot_cho.dat %>% 
  filter(!is.na(hunger_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, hunger_np, hunger_per, hunger_n)

dichot_hunger <- left_join(dichot_hunger, or_hunger, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(hunger_per = round(hunger_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, hunger_np, hunger_per, or_ci)

# odds ratios for naguib arms
naguib <- tribble(
  ~event_e, ~n_e, ~event_c, ~n_c, ~arm,
  37, 75, 19, 75,  "fasting",
  37, 75, 24, 75,  "water",
  37, 75, 39, 75,  "apple juice",
  37, 75, 30, 75,  "honey/cho")

naguib <- with(naguib, odds_ratio(event_e, n_e, event_c, n_c, arm)) %>% mutate(refid = 5803)
dichot_hunger$or_ci <- replace(dichot_hunger$or_ci, c(1:4), naguib$or_ci)
rm(naguib)

cho_row <- dichot_hunger %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_hunger$hunger_bar <- 0
dichot_hunger$hunger_bar <- ifelse(grepl("CHO", dichot_hunger$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_hunger$hunger_per),
  color_bar("lightgray", fun = dichot_format)(dichot_hunger$hunger_per))

dichot_hunger  <- dichot_hunger %>% 
  add_foot(study, "Koeppe 2013", "b") %>% 
  add_foot(study, "Taniguchi 2011", "d") %>% 
  add_foot(study, "Panebianco 2020", "c") %>% 
  add_foot(study, "TDrobjewski 2018", "e") %>% 
mutate(hunger_bar = str_replace(hunger_bar, ">[0-9][0-9]", ">&nbsp;"),
       study = ifelse(study == "Taniguchi 2011^d^", cell_spec(study, color = "black"), study))
  
dichot_hunger %>%
  mutate(
    arm_tx = as.character(arm_tx),
    arm_tx = ifelse(refid == 5803 & arm == 4, "CHO (Honey)", arm_tx),
    arm_tx = ifelse(refid == 5803 & arm_tx == "Clear", "Apple Juice", arm_tx)) %>%
  select(!c(refid, arm, design, age, hunger_per)) %>%
  select(study:hunger_np, hunger_bar, or_ci) %>%
  kbl(booktabs = T, align = c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6→2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Comparator")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Hunger" = 2, "OR (95% CI)"), line = TRUE) %>%
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "13em") %>%
  column_spec(2, width = "3em") %>%
  column_spec(3, width = "7em") %>%
  column_spec(c(4:6), width = "3em") %>%
  column_spec(7, width = "3em") %>%
  column_spec(8, width = "5em") %>%
  column_spec(9, width = "5em") %>%
  column_spec(10, width = "11em") %>%
  row_spec(cho_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 12) %>%
  pack_sub(., "RCT", 1, 11) %>%
  pack_sub(., "Prospective Cohort", 12, 12) %>%
  pack_top(., "Pedatric, Surgical", 13, 14) %>%
  pack_sub(., "RCT", 13, 14) %>%
  footnote(
    general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
    alphabet = c(
      "When outcome assessed relative to surgery (or endoscopy) where 0 is prior to induction.",
      "'Did you feel hunger during the fasting period?'",
      "Reported no hunger.",
      "Oral rehydration consumed between 5 and 2 hours prior to surgery. 'Did you feel hungry before surgery?' ",
      "Hunger present or absent."),
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

<font size = 4> Table `r table_n`. Comparative hunger ratings in included studies (surgical and nonsurgical) according to fasting, liquid and volume. </font>

```{r hungerTableLikert, include = TRUE}
## (updated 2021/01/13 05:51) hungerLikert --------------------------------
likert_cho_hung.dat <- likert.dat %>% 
  filter(refid %in% cho_refids$refid) %>% 
  filter(hunger_l == "hunger_l") %>% 
  # filter_at(vars(hunger_m:hunger_pval), any_vars(!is.na(.))) # 1290 not incpuded as RR in notes field
  select(refid:age, arm_n, arm_tx, likert_time_outcome, contains("ingest"), starts_with("hunger"), out_l_notes) %>% 
  mutate(arm_tx = droplevels(arm_tx)) %>% 
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx)

likert_cho_hung_kbl.dat <- likert_cho_hung.dat %>%
  rename(time_outcome = likert_time_outcome) %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6), # ) %>%  # Oyama PM
    # for nonsurgical
    hr_0 = 0, hr_minus2 = 0,
    hr_0 =      if_else(surg_nosurg != "surgical" & timeingest1 ==  0, amtingest1, hr_0, missing = 0),
    hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest1 == -2, amtingest1, hr_minus2, missing = 0),
    hr_0 =      if_else(surg_nosurg != "surgical" & timeingest2 ==  0, amtingest1, hr_0, missing = 0),
    hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest2 == -2, amtingest1, hr_minus2, missing = 0)) %>% 
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  # filter(surg_nosurg == "surgical") %>% 
  select(refid:arm_tx, hr_gt6, hr_26, hr_2, time_outcome, hunger_scale, hunger_m:hunger_iqru) %>%
  mutate(
    # fix Naguib Savluk Rizvanovic assume SEM
    hunger_sd = ifelse(refid %in% c(1274, 602, 431), hunger_sd * sqrt(arm_n), hunger_sd),
    # save hunger_med value 
    hung_md = hunger_med,
    hunger_med = paste0(hunger_med, " (", round_0(hunger_iqrl), "-", round_0(hunger_iqru), ")"),
    hunger_med = ifelse(refid %in% c(2674, 3588), paste0(hung_md, " (", round_1(hunger_iqrl), "-", round_1(hunger_iqru), ")"), hunger_med),
    hunger_med = ifelse(hunger_med == "NA (NA-NA)", NA, hunger_med),
    hunger_med = gsub(" \\(NA-NA\\)", "", hunger_med),
    # Melis use only median because is change score with IQR as just lower
    # NOTE: footnote c: "Within group change from baseline."
    hunger_med = ifelse(refid == 4952, paste0(hung_md, " (", round_0(hunger_iqrl), ")^c^"), hunger_med),
    ranges = str_c("(", round_0(hunger_rl), "-", round_0(hunger_ru), ")"),
    hunger_sd = ifelse(is.na(hunger_sd) & !is.na(hunger95u), sd_confint(hunger95l, hunger95u), hunger_sd), 
    mn_95_ci = str_c(round_1(hunger_m), " (", round_1(hunger95l), "-", round_1(hunger95u), ")"),
    mn_95_ci = ifelse(!is.na(hunger_m) & !is.na(hunger_sd), str_c(round_1(hunger_m), " (", round_1(hunger_m - (1.96*hunger_sd)), "-", round_1(hunger_m + (1.96*hunger_sd)), ")"), mn_95_ci),
    mn_95_ci = ifelse(mn_95_ci == "NA (NA-NA)", NA, mn_95_ci),
    mn_95_ci = str_replace(mn_95_ci, "\\(NA-NA\\)", ""),
    # mn_sd = NA, 
    mn_sd = ifelse(!is.na(hunger_sd) & !is.na(hunger_m), paste0(round_1(hunger_m), " (", round_1(hunger_sd), ")"), hunger_m), 
    hunger_med = str_replace(hunger_med, "\\(NA-NA\\)", ""),
    ranges = str_replace(ranges, "\\(NA-NA\\)", ""),
    # NOTE: footnote e: Hunger Satiety Scale
    hunger_scale = ifelse(hunger_scale == "VAS: 0 to 100", "0→100", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 0-100", "0→100", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 0 to 100", "0→100", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 0 to 10", "0→10", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 1 to 10", "0→10", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 0-10", "0→10", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "NRS, 0 to 10", "0→10^NRS^", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "NRS, 0 to 2", "0→2^NRS^", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "NRS, 0 to 3", "0→3^NRS^", hunger_scale), 
    hunger_scale = ifelse(hunger_scale == "Likert, 0 to 3", "0→3^NRS^", hunger_scale), 
    hunger_scale = ifelse(refid == 3588, "1→5^NRS^", hunger_scale),
    hunger_scale = ifelse(refid == 1315, "5→1 HSS^g^", hunger_scale),
    hunger_med = ifelse(grepl("(AM)", study) & arm_tx == "Fasting", str_c(hunger_med, "^f^"), hunger_med),
    hunger_med = ifelse(grepl("(PM)", study) & arm_tx == "Fasting", str_c(hunger_med, "^f^"), hunger_med), 
    time_outcome = ifelse(study == "Wendling 2020",  paste0(time_outcome, "^e^"), time_outcome),
    # TODO: z "Change from ingestion to 1 hour later."
    time_outcome = ifelse(study == "Savluk 2017"," ?^d^", time_outcome)) %>%
    # TODO: z "Time outcome assessed not reported."
  # remove second line study identifier
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    hunger_scale = ifelse(row_number() == 1, hunger_scale, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup()

```

```{r hungerAdultSurgKable, echo = FALSE}
## (updated 2020/12/13 13:48) hungerAdultSurgKable ------------------------
cho_row <- likert_cho_hung_kbl.dat %>%
  mutate(line = row_number()) %>%
  filter(arm_tx %in% c("CHO/Prot", "CHO")) %>%
  pull(line)

likert_cho_hung_kbl.dat %>%
  mutate(arm_tx = ifelse(refid == 1315 & arm_tx == "Clear", "Apple juice", as.character(arm_tx))) %>% 
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, time_outcome, hunger_scale, mn_sd, hunger_med, ranges) %>%
  add_row() %>% 
  kbl(booktabs = T, align = c("llccccclll"), escape = FALSE,
      col.names = c(
        "\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N",  "> 6", "6→2", "≤ 2", "Time (hr)^a^", "Scale^b^", "M (SD)",
        "Med (IQR)", "Range")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Hunger Rating" = 5), line = TRUE) %>%
  # NOTE: footnote a: includes at 2.5 hours
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "8em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(3, width = "2em") %>%
  column_spec(c(4:6), width = "2em") %>%
  column_spec(7, width = "5em") %>%
  column_spec(8, width = "4em") %>%
  column_spec(9, width = "5em") %>%
  column_spec(10, width = "5em") %>%
  column_spec(11, width = "4em") %>% 
  row_spec(cho_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 70) %>%
  pack_sub(., "RCT", 1, 64) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 65, 70) %>% 
  pack_top(., "Adult, Non-surgical", 71, 72) %>%
  pack_sub(., "Crossover", 71, 72) %>% 
  pack_top(., "Pediatric, Non-surgical", 73, 77) %>%
  pack_sub(., "RCT", 73, 75) %>% 
  pack_sub(., "Crossover", 76, 77) %>% 
  footnote(
    general = "RCT: randomized controlled trial; M: mean; Med: median; IQR: interquartile range; NRS: numeric rating scale; MD: mean difference.",
    alphabet = c(
      "When outcome assessed relative to surgery where 0 is prior to induction and other values hours postop or relative to liquids in nonsurgical studies.",
      "Arrow (→) indicates best to worst hunger (visual analogue if not noted NRS).",
      "Within group change from baseline.",
      "Time outcome assessed not reported.",
      "Difference from before beverage consumption to 1 hr post-consumption",
      "IQR bound outside range of scale used.",
      # "Range as reported but apparent error being <1 or >5.",
      "Hunger Satiety Scale."),
    general_title = "",
    footnote_as_chunk = FALSE)

  table_n <- tab_inc()
```

<br>

### &ensp; Pooled (adult RCTs)

<br>

<font size = 4> Figure `r figure_n`. Pooled incidence from randomized trials reporting occurrence of hunger comparing carbohydrate drinks with fasting in adult surgical patients. </font>
<br>
```{r hungerMetaDichotDat, include = TRUE, fig.width = 10, fig.height = 3, fig.align = "center"}
## (updated 2021/01/13 09:48)  --------------------------------------------
hunger_meta.dat <- dichot_hunger %>% 
  filter(age == "Adult", design == "rct") %>% 
  filter(str_detect(arm_tx, "CHO|Fast")) %>% 
  mutate(arm_tx = as.character(arm_tx),
    arm_tx = ifelse(arm_tx == "CHO/Prot", "CHO", arm_tx),
    n = as.numeric(str_extract(hunger_np, "^\\d{1,2}"))) %>% 
  select(refid, study, arm_tx, n, arm_n) %>% 
  group_by(refid) %>% 
  fill(study) %>% 
  ungroup() %>% 
  pivot_wider(id_cols = c("refid", "study"), names_from = "arm_tx", values_from = c("n", "arm_n"), values_fn = sum) %>% 
  rename(fast_e = n_Fasting, fast_n = arm_n_Fasting, cho_e = n_CHO, cho_n = arm_n_CHO) %>% 
  select(refid, study, fast_e, fast_n, cho_e, cho_n) %>% 
  mutate(study = str_replace(study, "\\^[a-z]\\^", ""))

hunger_meta <- metabin(cho_e, cho_n, fast_e, fast_n,
  data = hunger_meta.dat,
  studlab = study,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(hunger_meta,
  comb.fixed = TRUE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()
```

<br>

<font size = 4> Figure `r figure_n`. Pooled hunger ratings (VAS or NRS) from randomized trials comparing carbohydrate drinks with fasting in adult surgical patients. </font>
<br>
```{r hungerAdultLikertMeta, echo = FALSE, fig.width = 11, fig.height = 5.5, fig.align = "center"}
hung_lik_meta.dat <- likert_cho_hung_kbl.dat %>% 
  filter(age == "Adult", design == "rct") %>% 
  # remove Naguib Melis lacking data to pool
  # Results from 4 studies were not included in the meta-analysis. dNaguib 2001 and Mellis 2006 did not report sufficient data to estimate effects. Estimated standard errors from ranges reported in Yagmudrur 2011 were exceedingly small yielding an outlier effect. Reported IQR from Zhang 2019 carbohydrate arm did not allow variance estimation. 
  filter(!refid %in% c(5803, 4952, 1290)) %>% 
  # Yagmudrur 2011 outlier; Zhang 2019 numerical
  filter(!refid %in% c(3553, 743)) %>% 
  select(refid, study, arm_tx, arm_n, hunger_m, hunger_sd, hung_md, hunger_iqrl, hunger_iqru, hunger_rl, hunger_ru) %>% 
  group_by(refid) %>% 
  fill(study) %>% 
  ungroup() %>% 
  mutate(hunger_m = ifelse(study == "Savluk 2017" & arm_tx == "CHO", 2.675, hunger_m),
         arm_n = ifelse(study == "Savluk 2017" & arm_tx == "CHO", 113, arm_n),
         hunger_sd = ifelse(study == "Savluk 2017" & arm_tx == "CHO", 1.227, hunger_sd),
         hunger_iqrl = ifelse(study == "Canbay 2014", NA, hunger_iqrl),
         hunger_iqru = ifelse(study == "Canbay 2014", NA, hunger_iqru),
         hunger_iqrl = ifelse(study == "Zhang 2019" & arm_tx == "CHO", 9, hunger_iqrl),
         hunger_iqru = ifelse(study == "Zhang 2019" & arm_tx == "CHO", 11, hunger_iqru))

# fasting
fast_meta.dat <- hung_lik_meta.dat %>% 
  filter(arm_tx %in% c("Fasting", "CHO")) %>% 
  group_by(refid) %>% 
  filter(n() > 1) %>%
  filter(row_number() < 3) %>% 
  ungroup() %>% 
  select(-refid) %>% 
  pivot_wider(id_cols = "study", names_from = "arm_tx", values_from = arm_n:hunger_ru)

temp <- metacont(
  n.e = arm_n_CHO, n.c = arm_n_Fasting,
  comb.fixed = TRUE,
  mean.e = hunger_m_CHO,
  sd.e = hunger_sd_CHO,
  median.e = hung_md_CHO,
  q1.e = hunger_iqrl_CHO,
  q3.e = hunger_iqru_CHO,
  min.e = hunger_rl_CHO,
  max.e = hunger_ru_CHO,
  mean.c = hunger_m_Fasting,
  sd.c = hunger_sd_Fasting,
  median.c = hung_md_Fasting,
  q1.c = hunger_iqrl_Fasting,
  q3.c = hunger_iqru_Fasting,
  min.c = hunger_rl_Fasting,
  max.c = hunger_ru_Fasting,
  data = fast_meta.dat,
  sm = "SMD",
  hakn = TRUE,
  prediction = TRUE,
  studlab = study
)

forest(temp, 
       comb.random = TRUE,
       lab.e = "CHO     ",
       lab.c = "Fasting     ",
       digits = 1,
       digits.sd = 1,
       digits.tau2 = 1,
       overall.hetstat = TRUE,
       print.I2.ci = TRUE,
       print.byvar = FALSE,
       #overall = FALSE,
       fs.xlab = 11,
       sortvar = -TE,
       xlim = c(-3, 1),
       rightcols = c("effect", "ci"),
       xlab = "Favors CHO              Favors Fasting")

# metabias(temp, method = "linreg")
# radial(temp, level = 0.95)

```
Results from 4 studies were not included in the meta-analysis. dNaguib 2001 and Mellis 2006 did not report sufficient data to estimate effects. Estimated standard errors from ranges reported in Yagmudrur 2011 were exceedingly small yielding an outlier effect. Reported IQR from Zhang 2019 carbohydrate arm did not allow variance estimation. 

<br>

<font size = 4> Figure `r figure_n`. Funnel plot with 90%, 95%, and 99% contours --- consistent with small study effects (noting limitations with respect to SMD[@Zwetsloot2017]). </font>
```{r hungerAdultLikertFunnel, echo = FALSE, fig.width = 6, fig.height = 4, fig.align = "center"}
par(bty = "n", xaxt = "l", yaxt = "l")
funnel(temp, contour = c(0.9, 0.95, 0.99), xlim = c(-3, 1))
```
<br>

### Thirst

<br>

<font size = 4> Table `r table_n`. Comparative thirst ratings according to fasting, liquid and volume. </font>

```{r thirstTableOr, include = TRUE}
## (updated 2021/01/13 08:52) thirstTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_thirst_or <- dichot_cho.dat %>% 
  filter(!is.na(thirst_np)) %>%
  select(refid, study, arm_tx, arm_n, thirst_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_thirst <- with(or_join(dichot_thirst_or, "thirst"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))

```

```{r thirstTable, include = TRUE}
## (updated 2021/01/12 18:04) thirstTable ---------------------------------
dichot_thirst <- dichot_cho.dat %>% 
  filter(!is.na(thirst_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, thirst_np, thirst_per, thirst_n)

dichot_thirst <- left_join(dichot_thirst, or_thirst, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(thirst_per = round(thirst_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, thirst_np, thirst_per, or_ci)

cho_row <- dichot_thirst %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_thirst$thirst_bar <- NA
dichot_thirst$thirst_bar <- ifelse(grepl("CHO", dichot_thirst$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_thirst$thirst_per),
  color_bar("lightgray", fun = dichot_format)(dichot_thirst$thirst_per))

dichot_thirst  <- dichot_thirst %>% 
  add_foot(study, "Feguri 2012", "b") %>% #                  'Reported thirst'.
  add_foot(study, "Koeppe 2013", "c") %>% #           'Did you feel thirst during the fasting period?
  add_foot(study, "Yildiz 2013", "d") %>% #                  'Based on VAS scores.'
  add_foot(study, "Panebianco 2020", "e") %>% #       'None vs. a little or alot.'
  add_foot(study, "Labuschagne 2017", "f") %>% #             'Yes vs. no.'
  add_foot(study, "Taniguchi 2011", "g") %>% #        'Did you have a dry mouth before surgery?'
  add_foot(study, "Tudor-Drobjewski 2018", "h") %>% # 'Present or absent.'
mutate(thirst_bar = str_replace(thirst_bar, ">[0-9][0-9]", ">&nbsp;"),
       thirst_bar = str_replace(thirst_bar, ">0", ">"),
       study = ifelse(study == "Taniguchi 2011^g^", cell_spec(study, color = "black"), study))
  
dichot_thirst %>% 
  select(!c(refid, arm, design, age, thirst_per)) %>% 
  select(study:thirst_np, thirst_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6 → 2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Comparator")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Thirst" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "13em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4:6), width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "5em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "8em") %>% 
  row_spec(cho_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 11) %>% 
  pack_sub(., "RCT", 1, 8) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 9, 10) %>%
  pack_sub(., "Retrospective Cohort", 11, 11) %>%
  pack_top(., "Pedatric, Surgical", 12, 13) %>% 
  pack_sub(., "RCT", 12, 13) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("When outcome assessed relative to surgery where 0 is prior to induction.", 
                        "Reported thirst.",
                        "'Did you feel thirst during the fasting period?' (prior to endoscopy)",
                        "Based on VAS scores'",
                        "'None vs. a little or alot.'",
                        "Yes vs. no.",
                        "'Did you have a dry mouth before surgery?'",
                        "Thirst present or absent."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

### &nbsp;&nbsp; Pooled (adult RCTs) 

<font size = 4> Figure `r figure_n`. Pooled incidence of thirst --- randomized trials comparing carbohydrate drinks with fasting in adult surgical patients. </font>

```{r thirstMetaDichot, include = TRUE,  fig.width = 10, fig.height = 3.5, fig.align = "center"}
## (updated 2021/01/13 09:48)  --------------------------------------------
# data
thirst_meta.dat <- or_join(dichot_thirst_or, "thirst")
# add age, design, year
thirst_meta.dat <- left_join(thirst_meta.dat, study_char.dat %>% select(refid, year, design, age), by = "refid") %>% 
  filter(c_tx == "Fasting", age == "Adult", design == "rct")

thirst_meta <- metabin(event_e, n_e, event_c, n_c,
  data = thirst_meta.dat,
  studlab = study,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(thirst_meta,
  comb.fixed = TRUE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  xlim = c(.002, 2),
  at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = TRUE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = FALSE,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()

```

<br>

### Nausea 

<br>

<font size = 4> Table `r table_n`. Comparative nausea ratings according to fasting, liquid and volume. </font>

```{r nauseaTableOr, include = TRUE}
## (updated 2021/01/13 08:52) nauseaTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_nausea_or <- dichot_cho.dat %>% 
  filter(!is.na(nausea_np)) %>%
  select(refid, study, arm_tx, arm_n, nausea_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_nausea <- with(or_join(dichot_nausea_or, "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))

```

```{r nauseaTable, include = TRUE}
## (updated 2021/01/12 18:04) hungerTable ---------------------------------
dichot_nausea <- dichot_cho.dat %>% 
  filter(!is.na(nausea_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, nausea_np, nausea_per, nausea_n)

dichot_nausea <- left_join(dichot_nausea, or_nausea, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(nausea_per = round(nausea_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, nausea_np, nausea_per, or_ci)

# correct Hausel 2005 odds ratios
# CHO vs fasting, placebo
temp <- dichot_nausea_or %>% filter(refid == 5091)
a <- with(or_join(temp[c(1,3),], "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
b <- with(or_join(temp[c(2,3),], "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
# correct Askura 2015 odds ratios
temp <- dichot_nausea_or %>% filter(refid == 2234)
# CHO vs fasting, placebo
c <- with(or_join(temp[c(1,3),], "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
d <- with(or_join(temp[c(2,3),], "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
# correct Singh 2015 odds ratios
temp <- dichot_nausea_or %>% filter(refid == 2172)
# CHO vs fasting, placebo
e <- with(or_join(temp[c(1,3),], "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
f <- with(or_join(temp[c(2,3),], "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)

dichot_nausea <- dichot_nausea %>% 
  mutate(or_ci = ifelse(refid == 5091 & arm == 1, a, or_ci),
         or_ci = ifelse(refid == 5091 & arm == 2, b, or_ci),
         or_ci = ifelse(refid == 2234 & arm == 1, c, or_ci),
         or_ci = ifelse(refid == 2234 & arm == 2, d, or_ci),
         or_ci = ifelse(refid == 2172 & arm == 1, e, or_ci),
         or_ci = ifelse(refid == 2172 & arm == 2, f, or_ci),
        # remove Panebianco 2020 274
         or_ci = ifelse(refid == 274 & arm == 2, "", or_ci),
         or_ci = ifelse(or_ci == "NA (NA, NA)", "", or_ci))

rm(a, b, c, d, e, f)

cho_row <- dichot_nausea %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_nausea$nausea_bar <- NA
dichot_nausea$nausea_bar <- ifelse(grepl("CHO", dichot_nausea$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_nausea$nausea_per),
  color_bar("lightgray", fun = dichot_format)(dichot_nausea$nausea_per))

dichot_nausea  <- dichot_nausea %>% 
  # add_foot(study, "Feguri 2012", "b") %>% #                  'Reported nausea'.
  # add_foot(study, "Koeppe 2013", "c") %>% #           'Did you feel nausea during the fasting period?
  # add_foot(study, "Yildiz 2013", "d") %>% #                  'Based on VAS scores.'
  # add_foot(study, "Panebianco 2020", "e") %>% #       'None vs. a little or alot.'
  # add_foot(study, "Labuschagne 2017", "f") %>% #             'Yes vs. no.'
  # add_foot(study, "Taniguchi 2011", "g") %>% #        'Did you have a dry mouth before surgery?'
  # add_foot(study, "Tudor-Drobjewski 2018", "h") %>% # 'Present or absent.'
mutate(nausea_bar = str_replace(nausea_bar, ">0", ">"),
       nausea_bar = str_replace(nausea_bar, ">[0-9]{1,}", ">&nbsp;"))
       # study = ifelse(study == "Taniguchi 2011^g^", cell_spec(study, color = "black"), study))
  
dichot_nausea %>% 
  select(!c(refid, arm, design, age, nausea_per)) %>% 
  select(study:nausea_np, nausea_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6 → 2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Comparator")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "nausea" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4,6), width = "1em") %>% 
  column_spec(5, width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "2em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "5em") %>% 
  row_spec(cho_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 45) %>% 
  pack_sub(., "RCT", 1, 41) %>%
  pack_sub(., "Retrospective Cohort", 42, 43) %>%
  pack_sub(., "Before-After", 44, 45) %>%
  # pack_sub(., "Nonrandomized Studies of Interventions", 9, 10) %>%
  pack_top(., "Pedatric, Surgical", 46, 50) %>% 
  pack_sub(., "RCT", 46, 49) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("When outcome assessed relative to surgery where 0 is prior to induction."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

### &nbsp;&nbsp; Pooled (adult RCTs) 

<font size = 4> Figure `r figure_n`. Pooled incidence of nausea --- randomized trials comparing carbohydrate drinks with fasting in adult surgical patients. </font>

```{r nauseaMetaDichot, include = TRUE,  fig.width = 10, fig.height = 6.5, fig.align = "center"}
## (updated 2021/01/13 09:48)  --------------------------------------------
# data
# cho vs fasting
nausea_meta.dat <- or_join(dichot_nausea_or, "nausea") %>% 
  filter(c_tx == "Fasting") %>% 
  filter(!refid %in% c(5091, 2172))

# Hausel
temp <- dichot_nausea_or %>% filter(refid == 5091)
a <- or_join(temp[c(1,3),], "nausea")
temp <- dichot_nausea_or %>% filter(refid == 2172)
b <- or_join(temp[c(1,3),], "nausea")

nausea_meta.dat <- bind_rows(nausea_meta.dat, a, b)
rm(a, b)

# add age, design, year
nausea_meta.dat <- left_join(nausea_meta.dat, study_char.dat %>% select(refid, year, design, age), by = "refid") %>% 
  filter(c_tx == "Fasting", age == "Adult", design == "rct") %>% 
  arrange(year)

nausea_meta <- metabin(event_e, n_e, event_c, n_c,
  data = nausea_meta.dat,
  studlab = study,
  byvar = tx,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(nausea_meta,
  comb.fixed = FALSE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  # xlim = c(.002, 2),
  # at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = TRUE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = TRUE,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()

```

<br>

<font size = 4> Figure `r figure_n`. Pooled incidence of nausea --- randomized trials comparing carbohydrate drinks with water or placebo in adult surgical patients. </font>

```{r nauseaMetaDichotPlacWater, include = TRUE,  fig.width = 10, fig.height = 4, fig.align = "center"}
## (updated 2021/01/13 09:48)  --------------------------------------------
# data
# cho vs fasting
nausea_meta.dat <- or_join(dichot_nausea_or, "nausea") %>% 
  filter(c_tx %in% c("Water", "Placebo")) %>% 
  filter(!refid %in% c(5091, 2172))

# Hausel
temp <- dichot_nausea_or %>% filter(refid == 5091)
a <- or_join(temp[c(2,3),], "nausea")
# Singh
temp <- dichot_nausea_or %>% filter(refid == 2172)
b <- or_join(temp[c(2,3),], "nausea")

nausea_meta.dat <- bind_rows(nausea_meta.dat, a, b)
rm(a, b)

# add age, design, year
nausea_meta.dat <- left_join(nausea_meta.dat, study_char.dat %>% select(refid, year, design, age), by = "refid") %>% 
  arrange(year)

nausea_meta <- metabin(event_e, n_e, event_c, n_c,
  data = nausea_meta.dat,
  studlab = study,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(nausea_meta,
  comb.fixed = FALSE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  # xlim = c(.002, 2),
  # at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = FALSE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = FALSE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()

```

<br>

### Discomfort 

<br>

<font size = 4> Table `r table_n`. Reported discomfort in a randomized trial of patients undergoing upper gastrointestinal endoscopy according to fasting, liquid and volume. </font>

```{r comfortTableOr, include = TRUE}
##  (updated 2021/01/13 08:52) comfortTableOr --------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_comfort_or <- dichot_cho.dat %>% 
  filter(!is.na(comfort_np)) %>%
  select(refid, study, arm_tx, arm_n, comfort_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_comfort <- with(or_join(dichot_comfort_or, "comfort"), odds_ratio(event_c, n_c, event_e, n_e, refid = refid, digits = 2))

```

```{r comfortTable, include = TRUE}
## (updated 2021/01/12 18:04) comfortTable ---------------------------------
dichot_format <- function(x) (x/100)

dichot_comfort <- dichot_cho.dat %>% 
  filter(!is.na(comfort_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, comfort_np, comfort_per, comfort_n)

dichot_comfort <- left_join(dichot_comfort, or_comfort, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(comfort_per = round(comfort_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, comfort_np, comfort_per, or_ci)

cho_row <- dichot_comfort %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_comfort$comfort_bar <- NA
dichot_comfort$comfort_bar <- ifelse(grepl("CHO", dichot_comfort$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(100 - dichot_comfort$comfort_per),
  color_bar("lightgray", fun = dichot_format)(100 - dichot_comfort$comfort_per))

dichot_comfort  <- dichot_comfort %>% 
mutate(comfort_bar = str_replace(comfort_bar, ">0", ">"),
       comfort_bar = str_replace(comfort_bar, ">[0-9]{1,}", ">&nbsp;"))
  
dichot_comfort %>% 
  select(!c(refid, arm, design, age, comfort_per)) %>% 
  select(study:comfort_np, comfort_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6 → 2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Comparator")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Comfort" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4,6), width = "1em") %>% 
  column_spec(5, width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "2em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "5em") %>% 
  row_spec(cho_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 2) %>% 
  pack_sub(., "RCT", 1, 2) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("When outcome assessed relative to surgery where 0 is prior to induction."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

### Patient Satisfaction

<br>

<font size = 4> Table `r table_n`. Patient satisfaction ratings according to fasting, liquid and volume. </font>

```{r satisLikert, include = TRUE}
## (updated 2021/01/29 08:30) satisLikert ---------------------------------
# no subgroup data
likert_cho_satis.dat <- likert.dat %>%
  filter(refid %in% cho_refids$refid) %>%
  filter(refid != 926) %>% 
  # delete Asakura as abstracted QoR emotional
  filter(pt_satis_l == "pt_satis_l", refid != 2234) %>%
  # filter_at(vars(satis_m:satis_pval), any_vars(!is.na(.))) # same
  select(refid:age, arm_n, arm_tx, likert_time_outcome, contains("ingest"), contains("satis")) %>%
  mutate(arm_tx = droplevels(arm_tx)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx)

likert_cho_satis_kbl.dat <- likert_cho_satis.dat %>%
  rename(time_outcome = likert_time_outcome) %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6),  # Oyama PM
    arm_tx = as.character(arm_tx),
    arm_tx = ifelse(study == "Marquini 2020c" & arm_tx == "Clear", "Water^d^", arm_tx)) %>%
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  # Footnote: distilled water, 4 drops red dye, 2 drops sucrose
  select(refid:arm_tx, hr_gt6, hr_26, hr_2, time_outcome, satisfaction_scale, satis_m:satis_iqru) %>%
  mutate(
    satis_med = paste0(satis_med, " (", satis_iqrl, "-", satis_iqru, ")"),
    satis_med = ifelse(satis_med == "NA (NA-NA)", NA, satis_med),
    satis_med = gsub(" \\(NA-NA\\)", "", satis_med),
    ranges = str_c("(", satis_rl, "-", satis_ru, ")"),
    mn_95_ci = str_c(round_1(satis_m), " (", round_1(satis95l), "-", round_1(satis95u), ")"),
    mn_95_ci = ifelse(mn_95_ci == "NA (NA-NA)", NA, mn_95_ci),
    satis_sd = ifelse(is.na(satis_sd) & !is.na(satis95l), sd_confint(satis95l, satis95u), satis_sd),
    satis_m = ifelse(!is.na(satis_m), paste0(round_1(satis_m), " (", round_1(satis_sd), ")"), satis_m),
    satisfaction_scale = ifelse(satisfaction_scale == "NRS, 1 to 5", "NRS 1→5", satisfaction_scale),
    satisfaction_scale = ifelse(satisfaction_scale == "NRS, range unspecified", "NRS low→high^c^", satisfaction_scale),
    # footnote Range not specified (presumably 1 to 10).
    satisfaction_scale = ifelse(satisfaction_scale == "0-10 scale", "NRS 10→0^e^", satisfaction_scale),
    # x Parental satisfaction.
    satisfaction_scale = ifelse(satisfaction_scale == "VAS, 0 to 10", "VAS 0→10", satisfaction_scale)) %>% 
  # remove second line study identifier
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    satisfaction_scale = ifelse(row_number() == 1, satisfaction_scale, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup()
```

```{r satisAdultSurgKable, echo = FALSE}
## (updated 2021/01/29 08:30) satisAdultSurgKable -------------------------
cho_row <- likert_cho_satis_kbl.dat %>%
  mutate(line = row_number()) %>%
  filter(arm_tx == "CHO") %>%
  pull(line)

likert_cho_satis_kbl.dat %>%
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, time_outcome, satisfaction_scale, satis_m, satis_med, ranges) %>%
  mutate(
  study = ifelse(study == "Song 2016", cell_spec(study, color = "black"), study)) %>% 
  add_row() %>% 
  kbl(booktabs = T, align = c("llcccccllll"), escape = FALSE,
      col.names = c(
        "\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N",  "> 6", "6→2", "≤ 2", "Time (hr)^a^", "Scale^b^", "M (SD)",
        "Med (IQR)", "Range")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Satisfaction Rating\n *(Between-group Comparison)*" = 5), line = TRUE) %>%
  # NOTE: footnote a: includes at 2.5 hours
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "11em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(3, width = "2em") %>%
  column_spec(c(4:6), width = "3em") %>%
  column_spec(7, width = "7em") %>%
  column_spec(8, width = "9em") %>%
  column_spec(9, width = "6em") %>%
  column_spec(10, width = "6em") %>%
  column_spec(11, width = "6em") %>% 
  row_spec(cho_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 7) %>%
  pack_sub(., "RCT", 1, 7) %>%
   pack_rows("P = 0.01; MD^f^\\ 1.76 (95% CI, 1.59 to 1.93)", 8, 8, label_row_css = "padding-left:68%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("CHO vs Water:\\  \\ MD^f^ 2.00 (95% CI, 1.66-2.34)", 4, 4, label_row_css = "padding-left:68%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("CHO vs Fasting: MD^f^ 4.00 (95% CI, 3.71-4.29)", 4, 4, label_row_css = "padding-left:68%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_top(., "Pediatric, Surgical", 8, 8) %>%
  pack_sub(., "Prospective Cohort", 8, 8) %>%
  footnote(
    general = "RCT: randomized controlled trial; M: mean; Med: median; IQR: interquartile range; MD: mean difference.",
    alphabet = c(
      "When outcome assessed relative to surgery where 0 is prior to induction.",
      "Arrow (→) indicating low to high patient satisfaction.",
      "Range not specified (presumably 1 to 10).",
      "Distilled water, 4 drops red dye, 2 drops sucrose.",
      "Parental satisfaction.",
      "Calculated."),
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```
<br>


<hr style="height:3px;border-width:0;color:gray;background-color:gray">

# **Clinical Outcomes**
## Aspiration

<br>

<font size = 4> Table `r table_n`. Studies reporting no occurrence of aspiration and number of participants according to liquid received. </font>

```{r aspirateTableReport, include = TRUE}
## (updated 2021/01/12 18:04) aspirateTableReport -------------------------
dichot_cho.dat %>% 
  filter(!is.na(aspirate_np)) %>%
  filter(surg_nosurg == "surgical") %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid, design, age, study, arm_n, arm_tx) %>% 
  pivot_wider(id_cols = c(refid, study, age, design), 
              names_from = arm_tx, 
              values_from = arm_n,
              values_fn = sum) %>% 
  # exclude duplicate Marquini publications
  filter(!refid %in% c(6446, 247)) %>% 
  mutate(study = ifelse(refid == 165, "Marquini 2020", study)) %>% 
  select(study, Fasting, Water, Placebo, Clear, CHO, "CHO/Prot") %>% 
  janitor::adorn_totals(c("col", "row"), fill = "-", na.rm = TRUE) %>% 
  kbl(booktabs = T, align =  c("lccccccr"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Fasting", "Water", "Placebo", "Clear", "CHO", "CHO/Prot", "Total")) %>% 
  add_header_above(c(" " = 1, "Liquid" = 6, " " = 1), line = TRUE) %>%
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "13em") %>%  
  column_spec(2:7, width = "5em") %>% 
  column_spec(8, width = "5em") %>% 
  row_spec(47, bold = TRUE) %>% 
  column_spec(8, bold = TRUE) %>% 
  pack_top(., "Adult, Surgical", 1, 42) %>% 
  pack_sub(., "RCT", 1, 35) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 36, 40) %>%
  pack_sub(., "Prospective Cohort", 41, 41) %>%
  pack_sub(., "Case-Control", 42, 42) %>%
  pack_top(., "Pediatric, Surgical", 43, 46) %>% 
  pack_sub(., "RCT", 43, 45) %>%
  pack_sub(., "Prospective Cohort", 46, 46) %>%
  #pack_sub(., "Retrospective Cohort", 16, 17) %>%
  footnote(general = "CHO: carbohydrate; Prot: protein.",
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

<font size = 4> Table `r table_n`. Studies silent on whether or not aspiration occurred. </font>

```{r aspirateTableNoReport, include = TRUE}
## (updated 2021/01/12 18:04) aspirateTableReport -------------------------

dichot_cho.dat %>% 
  filter(is.na(aspirate_np)) %>%
  filter(surg_nosurg == "surgical") %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid, design, age, study, arm_n, arm_tx) %>% 
  pivot_wider(id_cols = c(refid, study, age, design), 
              names_from = arm_tx, 
              values_from = arm_n,
              values_fn = sum) %>% 
  # exclude duplicate Marquini publications
  filter(!refid %in% c(6446, 247)) %>% 
  mutate(study = ifelse(refid == 165, "Marquini 2020", study)) %>% 
  select(study, Fasting, Water, Placebo, Clear, CHO, "CHO/Prot") %>% 
  janitor::adorn_totals(c("col", "row"), fill = "-", na.rm = TRUE) %>% 
  kbl(booktabs = T, align =  c("lccccccr"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Fasting", "Water", "Placebo", "Clear", "CHO", "CHO/Prot", "Total")) %>% 
  add_header_above(c(" " = 1, "Liquid" = 6, " " = 1), line = TRUE) %>%
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "13em") %>%  
  column_spec(2:7, width = "5em") %>% 
  column_spec(8, width = "5em") %>% 
  row_spec(30, bold = TRUE) %>% 
  column_spec(8, bold = TRUE) %>% 
  pack_top(., "Adult, Surgical", 1, 27) %>% 
  pack_sub(., "RCT", 1, 21) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 22, 24) %>%
  pack_sub(., "Prospective Cohort", 25, 25) %>%
  pack_sub(., "Retrospective Cohort", 26, 26) %>%
  pack_sub(., "Before-After", 27, 27) %>%
  pack_top(., "Pediatric, Surgical", 28, 29) %>% 
  pack_sub(., "RCT", 28, 29) %>%
  footnote(general = "CHO: carbohydrate; Prot: protein.",
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()

```

<br>

## Regurgitation

<br>

<font size = 4> Table `r table_n`. Occurrence of regurgitation according to fasting, liquid and volume. </font>

```{r regurgTableOr, include = TRUE}
## (updated 2021/01/12 09:42) regurgTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_regurg_or <- dichot_cho.dat %>% 
  filter(!is.na(regurg_np)) %>%
  select(refid, study, arm_tx, arm_n, regurg_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_regurg <- with(or_join(dichot_regurg_or, "regurg"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))
```

```{r regurgTable, include = TRUE}
## (updated 2021/01/12 18:04) regurgTable ---------------------------------
dichot_regurg <- dichot_cho.dat %>% 
  filter(!is.na(regurg_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, regurg_np, regurg_per, regurg_n)

dichot_regurg <- left_join(dichot_regurg, or_regurg, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    or_ci = ifelse(or_ci == "NA (NA, NA)", "", or_ci),
    or_ci = ifelse(study == "De Jonghe 2016", NA, or_ci),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(regurg_per = round(regurg_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, regurg_np, regurg_per, or_ci)

cho_row <- dichot_regurg %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_regurg$regurg_bar <- 0
dichot_regurg$regurg_bar <- ifelse(grepl("CHO", dichot_regurg$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_regurg$regurg_per),
  color_bar("lightgray", fun = dichot_format)(dichot_regurg$regurg_per))

tot_n <- sum(dichot_regurg$arm_n)

dichot_regurg  <- dichot_regurg %>% 
  add_foot(study, "Koeppe 2013", "b") %>% 
  mutate(regurg_bar = str_replace(regurg_bar, ">\\d+", ">&nbsp;"),
       regurg_bar = ifelse(regurg_per == 0, "", regurg_bar)) %>% 
  # add totals
  add_row(regurg_np = paste0(23, " (", round_2(23/tot_n), ")"), arm_n = tot_n, study = "Total")


dichot_regurg %>% 
  select(!c(refid, arm, design, age, regurg_per)) %>% 
  select(study:regurg_np, regurg_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6→2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Fasting")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Regurgitation" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "13em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4:6), width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "5em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "8em") %>% 
  row_spec(21, bold = TRUE) %>% 
  row_spec(cho_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 20) %>% 
  pack_sub(., "RCT", 1, 18) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 19, 20) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("At time of endocoscopy = 0",
           "Regurgitation at upper endoscopic intubation."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

## Vomiting 

<br>

<font size = 4> Table `r table_n`. Comparative vomiting ratings according to fasting, liquid and volume. </font>

```{r vomitTableOr, include = TRUE}
## (updated 2021/01/13 08:52) vomitTableOr --------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_vomit_or <- dichot_cho.dat %>% 
  filter(!is.na(vomit_np)) %>%
  select(refid, study, arm_tx, arm_n, vomit_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_vomit <- with(or_join(dichot_vomit_or, "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))

```

```{r vomitTable, include = TRUE}
## (updated 2021/01/12 18:04) vomitTable ---------------------------------
dichot_vomit <- dichot_cho.dat %>% 
  filter(!is.na(vomit_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, vomit_np, vomit_per, vomit_n)

dichot_vomit <- left_join(dichot_vomit, or_vomit, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(vomit_per = round(vomit_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, vomit_np, vomit_per, or_ci)

# correct Hausel 2005 odds ratios
# CHO vs fasting, placebo
temp <- dichot_vomit_or %>% filter(refid == 5091)
a <- with(or_join(temp[c(1,3),], "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
b <- with(or_join(temp[c(2,3),], "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
# correct Jiang 2018 odds ratios
temp <- dichot_vomit_or %>% filter(refid == 1228)
# CHO vs fasting, placebo
c <- with(or_join(temp[c(1,3),], "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
d <- with(or_join(temp[c(2,3),], "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
# correct Singh 2015 odds ratios
temp <- dichot_vomit_or %>% filter(refid == 2172)
# CHO vs fasting, placebo
e <- with(or_join(temp[c(1,3),], "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
f <- with(or_join(temp[c(2,3),], "vomit"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)

dichot_vomit <- dichot_vomit %>% 
  mutate(or_ci = ifelse(refid == 5091 & arm == 1, a, or_ci),
         or_ci = ifelse(refid == 5091 & arm == 2, b, or_ci),
         or_ci = ifelse(refid == 1228 & arm == 1, c, or_ci),
         or_ci = ifelse(refid == 1228 & arm == 2, d, or_ci),
         or_ci = ifelse(refid == 2172 & arm == 1, e, or_ci),
         or_ci = ifelse(refid == 2172 & arm == 2, f, or_ci),
         # remove Ravannni 2015 2256
         or_ci = ifelse(refid == 2256 & arm == 2, "", or_ci),
         or_ci = ifelse(or_ci == "NA (NA, NA)", "", or_ci))

rm(a, b, c, d, e, f)

cho_row <- dichot_vomit %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_vomit$vomit_bar <- NA
dichot_vomit$vomit_bar <- ifelse(grepl("CHO", dichot_vomit$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_vomit$vomit_per),
  color_bar("lightgray", fun = dichot_format)(dichot_vomit$vomit_per))

dichot_vomit  <- dichot_vomit %>% 
mutate(vomit_bar = str_replace(vomit_bar, ">0", ">"),
       vomit_bar = str_replace(vomit_bar, ">[0-9]{1,}", ">&nbsp;"),
       study = ifelse(study == "Taniguchi 2011", cell_spec(study, color = "black"), study),
       study = ifelse(study == "Song 2016", cell_spec(study, color = "black"), study))
  
dichot_vomit %>% 
  select(!c(refid, arm, design, age, vomit_per)) %>% 
  select(study:vomit_np, vomit_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6 → 2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Comparator")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "vomit" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4,6), width = "1em") %>% 
  column_spec(5, width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "2em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "5em") %>% 
  row_spec(cho_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 43) %>% 
  pack_sub(., "RCT", 1, 38) %>%
  pack_sub(., "Prospective Cohort", 39, 39) %>%
  pack_sub(., "Retrospective Cohort", 40, 41) %>%
  pack_sub(., "Case-Control", 42, 43) %>%
  # pack_sub(., "Nonrandomized Studies of Interventions", 9, 10) %>%
  pack_top(., "Pedatric, Surgical", 44, 53) %>% 
  pack_sub(., "RCT", 44, 52) %>%
  pack_sub(., "Prospective Cohort", 53, 53) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("When outcome assessed relative to surgery where 0 is prior to induction."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

### Pooled (adult RCTs) 

<font size = 4> Figure `r figure_n`. Pooled incidence of vomiting --- randomized trials comparing carbohydrate drinks with fasting in adult surgical patients. </font>

```{r vomitMetaDichot, include = TRUE,  fig.width = 10, fig.height = 6.5, fig.align = "center"}
## (updated 2021/01/13 09:48)  --------------------------------------------
# data
# cho vs fasting
vomit_meta.dat <- or_join(dichot_vomit_or, "vomit") %>% 
  filter(c_tx == "Fasting") %>% 
  filter(!refid %in% c(5091, 2172))

# Hausel
temp <- dichot_vomit_or %>% filter(refid == 5091)
a <- or_join(temp[c(1,3),], "vomit")
temp <- dichot_vomit_or %>% filter(refid == 2172)
b <- or_join(temp[c(1,3),], "vomit")

vomit_meta.dat <- bind_rows(vomit_meta.dat, a, b)
rm(a, b)

# add age, design, year
vomit_meta.dat <- left_join(vomit_meta.dat, study_char.dat %>% select(refid, year, design, age), by = "refid") %>% 
  filter(c_tx == "Fasting", age == "Adult", design == "rct") %>% 
  arrange(year)

vomit_meta <- metabin(event_e, n_e, event_c, n_c,
  data = vomit_meta.dat,
  studlab = study,
  byvar = tx,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(vomit_meta,
  comb.fixed = FALSE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  # xlim = c(.002, 2),
  # at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = TRUE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = TRUE,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()

```

<br>
<font size = 4> Figure `r figure_n`. Pooled incidence of vomiting --- randomized trials comparing carbohydrate drinks with water or placebo in adult surgical patients. </font>

```{r vomitMetaDichotPlacWater, include = TRUE,  fig.width = 10, fig.height = 4, fig.align = "center"}
## (updated 2021/01/13 09:48)  --------------------------------------------
# data
# cho vs fasting
vomit_meta.dat <- or_join(dichot_vomit_or, "vomit") %>% 
  filter(c_tx %in% c("Water", "Placebo")) %>% 
  filter(!refid %in% c(5091, 2172))

# Hausel
temp <- dichot_vomit_or %>% filter(refid == 5091)
a <- or_join(temp[c(2,3),], "vomit")
# Singh
temp <- dichot_vomit_or %>% filter(refid == 2172)
b <- or_join(temp[c(2,3),], "vomit")

vomit_meta.dat <- bind_rows(vomit_meta.dat, a, b)
rm(a, b)

# add age, design, year
vomit_meta.dat <- left_join(vomit_meta.dat, study_char.dat %>% select(refid, year, design, age), by = "refid") %>% 
  arrange(year)

vomit_meta <- metabin(event_e, n_e, event_c, n_c,
  data = vomit_meta.dat,
  studlab = study,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(vomit_meta,
  comb.fixed = FALSE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  # xlim = c(.002, 2),
  # at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = FALSE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = FALSE,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()

```

<br>

## Complications

<br>

<font size = 4> Table `r table_n`. Reported complications according to fasting, liquid and volume. </font>
```{r complicateTableOr, include = TRUE}
## (updated 2021/01/13 08:52) complicateTableOr --------------------------------
dichot_format <- function(x) (x/100)

# odds ratiosÔ
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_complicate_or <- dichot_cho.dat %>% 
  filter(!is.na(complicate_np)) %>%
  select(refid, study, arm_tx, arm_n, complicate_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_complicate <- with(or_join(dichot_complicate_or, "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))

```

```{r complicateTable, include = TRUE}
## (updated 2021/01/12 18:04) complicateTable ---------------------------------
dichot_complicate <- dichot_cho.dat %>% 
  filter(!is.na(complicate_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, complicate_np, complicate_per, complicate_n) %>% 
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% # all the same study
  mutate(study = ifelse(study == "Marquini 2020a", "Marquini 2020", study),
  # fix Breuer arms NOTE: not ideal but so doesn't break other code
  arm = ifelse(refid == 4766 & arm_n == 44, 1, arm),
  arm = ifelse(refid == 4766 & arm_n == 60, 2, arm),
  arm = ifelse(refid == 4766 & arm_n == 56, 3, arm))

dichot_complicate <- left_join(dichot_complicate, or_complicate, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(complicate_per = round(complicate_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, complicate_np, complicate_per, or_ci)

# correct odds ratios for multiarm studies
# Breuer 2006
temp <- dichot_complicate_or %>% filter(refid == 4766)
a <- with(or_join(temp[c(1,3),], "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
b <- with(or_join(temp[c(2,3),], "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
# DNascimento 2012a 3282
# CHO vs fasting, placebo
temp <- dichot_complicate_or %>% filter(refid == 3282)
c <- with(or_join(temp[c(1,3),], "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
d <- with(or_join(temp[c(2,3),], "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
# Ljunggren 2012 3371
# CHO vs fasting, placebo
temp <- dichot_complicate_or %>% filter(refid == 3371)
e <- with(or_join(temp[c(1,3),], "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)
f <- with(or_join(temp[c(2,3),], "complicate"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2)) %>% pull(or_ci)

dichot_complicate <- dichot_complicate %>% 
  mutate(or_ci = ifelse(refid == 4766 & arm == 1, a, or_ci),
         or_ci = ifelse(refid == 4766 & arm == 2, b, or_ci),
         or_ci = ifelse(refid == 3282 & arm == 1, c, or_ci),
         or_ci = ifelse(refid == 3282 & arm == 2, d, or_ci),
         or_ci = ifelse(refid == 3371 & arm == 1, e, or_ci),
         or_ci = ifelse(refid == 3371 & arm == 2, f, or_ci),
         or_ci = ifelse(or_ci == "NA (NA, NA)", "", or_ci))

rm(a, b, c, d, e, f)

cho_row <- dichot_complicate %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

dichot_complicate$complicate_bar <- NA
dichot_complicate$complicate_bar <- ifelse(grepl("CHO", dichot_complicate$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_complicate$complicate_per),
  color_bar("lightgray", fun = dichot_format)(dichot_complicate$complicate_per))

dichot_complicate  <- dichot_complicate %>% 
mutate(complicate_bar = str_replace(complicate_bar, ">0", ">"),
       complicate_bar = str_replace(complicate_bar, ">[0-9]{1,}", ">&nbsp;"),
       study = ifelse(study == "Alimena 2020", cell_spec(study, color = "black"), study),
       study = ifelse(study == "Song 2016", cell_spec(study, color = "black"), study))
  
dichot_complicate %>% 
  select(!c(refid, arm, design, age, complicate_per)) %>% 
  select(study:complicate_np, complicate_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6 → 2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Comparator")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Complications" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4,6), width = "1em") %>% 
  column_spec(5, width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "3em") %>% 
  column_spec(9, width = "4em") %>% 
  column_spec(10, width = "5em") %>% 
  row_spec(cho_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 69) %>% 
  pack_sub(., "RCT", 1, 62) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 63, 66) %>%
  pack_sub(., "Prospective Cohort", 67, 67) %>%
  pack_sub(., "Case-Control", 68, 69) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("When outcome assessed relative to surgery where 0 is prior to induction."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

<font size = 4> Table `r table_n`. Types of complications ascertained according to study (categorized according to Anderson [@Anderson2013}]). </font>

```{r ccomplicateTypes, include = TRUE}
complicate_data <- readxl::read_xlsx("data/CHOComplicationList_012521.xlsx", range = "A5:P35") %>% 
  clean_names()

compl_names <- c("SSI", "GU", "CV", "GI", "Pulm", "Anes", "Renal", "Meds", "Leak", "Op", "Bleed", "TE", "CVD", "Infect")
cats <-  c("Surgical Site Infection", "Genitourinary", "Cardiovascular", "Gastrointestinal", "Respiratory", "Anesthesia", "Fluid/electrolyte/renal", "Medication", "Anastomotic leak", "Intraoperative", "Bleeding", "Thromboembolic", "Cerebrovascular", "Other infection")
compl_foot <- paste0(compl_names, ": ", tolower(cats), collapse = "; ")
compl_foot <- paste0(compl_foot, ".")

complicate_data %>% 
  select(-design) %>% 
   kbl(booktabs = T, align =  c("l", rep("c", 14)), escape = FALSE,
    col.names = c("Study", rep(" ", 14))) %>% 
  #add_header_above(c(" " = 1, "Surgical Site Infection" = 1, "Genitourinary" = 1, "Cardiovascular" = 1, "Gastrointestinal" = 1, "Respiratory" = 1, "Anesthesia" = 1, "Fluid/electrolyte/renal" = 1, "Medication" = 1, "Anastomotic leak" = 1, "Intraoperative" = 1, "Bleeding" =1, "Thromboembolic" = 1, "Cerebrovascular" = 1, 	"Other infection" = 1), line = FALSE, angle = -90, align = "initial", line_sep = 20) %>% 
  add_header_above(c(" " = 1, compl_names), line = FALSE, angle = -45, align = "c", line_sep = 1) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "right", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2:15, width = "2em") %>% 
  pack_top(., "Adult, Surgical", 1, 30) %>% 
  pack_sub(., "RCT", 1, 26) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 27, 28) %>%
  pack_sub(., "Prospective Cohort", 29, 29) %>%
  pack_sub(., "Case-Control", 30, 30) %>%
  footnote(general = compl_foot,
           # alphabet = c(""),
           general_title = "",  
           footnote_as_chunk = FALSE)
```

<br>

## &ensp; Pooled (adult RCTs) 

<br>

<font size = 4> Figure `r figure_n`. Pooled incidence of complications --- randomized trials comparing carbohydrate drinks with fasting in adult surgical patients. </font>
```{r complicateMetaDichotDat, include = TRUE}
## (updated 2021/01/13 09:48)  --------------------------------------------
complicate_meta.dat <- dichot_cho.dat %>% 
  filter(!is.na(complicate_np)) %>%
  # Marquini b,c; nrsi Vigano 2012, Adamova 2017; cc Weledji 2017
  filter(!refid %in% c(6446, 247, 3367, 6529, 6530)) %>% 
  select(refid, study, arm_tx, arm_n, complicate_n, hr_gt6:hr_2) %>% 
  mutate(h2 = ifelse(!is.na(hr_2), "≤2 hr", hr_2),
         h26 = ifelse(!is.na(hr_26) & is.na(hr_2), ">2 to 6 hr", NA)) %>% 
         # h6 = ifelse(!is.na(hr_gt6) & is.na(hr_2) & is.na(hr_26), ">6 hrs", NA)) %>% 
  group_by(refid) %>% 
  filter(n() > 1) %>% 
  ungroup() %>% 
  select(!hr_gt6:hr_2)

complicate_meta.dat <- complicate_meta.dat %>%
  select(!c(h2, h26)) %>% 
  pivot_wider(
    names_from = arm_tx,
    values_from = c("arm_n", "complicate_n")) %>%
  janitor::clean_names() %>% 
  rename_at(vars(arm_n_placebo:arm_n_clear), ~ gsub("arm_", "", .)) %>% 
  rename_at(vars(starts_with("comp")),  ~ gsub("complicate_n", "event", .)) %>% 
  mutate(
    n_wplclr = coalesce(n_placebo, n_water, n_clear),
    e_wplclr = coalesce(event_placebo, event_water, event_clear),
    n_choall = coalesce(n_cho, n_cho_prot),
    e_choall = coalesce(event_cho, event_cho_prot),
    cho_prot = ifelse(!is.na(n_cho_prot), "CHO/Prot", "CHO")) %>% 
  rename(e_fasting = event_fasting) %>% 
  select(!c("n_placebo", "n_water", "n_clear", "n_cho", "n_cho_prot", "event_placebo", "event_water", "event_clear", "event_cho", "event_cho_prot"))

# add age, design, year
complicate_meta.dat <- left_join(complicate_meta.dat, study_char.dat %>% select(refid, year, design, age), by = "refid") %>% 
  arrange(year)
```

```{r complicateMetaDichotFast1, include = TRUE,  fig.width = 10, fig.height = 5, fig.align = "center"}
## (updated 2021/01/22 15:17) complicateMetaDichotFast1 -------------------
meta.dat <- complicate_meta.dat %>% 
  filter(!is.na(n_fasting)) %>% 
  filter(e_fasting + e_choall != 0)

complicate_meta <- metabin(e_choall, n_choall, e_fasting, n_fasting,
  data = meta.dat,
  studlab = study,
  byvar = cho_prot,
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(complicate_meta,
  comb.fixed = FALSE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  # xlim = c(.002, 2),
  # at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = TRUE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = TRUE,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()

```

<br>

<font size = 4> Figure `r figure_n`. Pooled incidence of complications --- randomized trials comparing carbohydrate drinks with water, placebo, or clear liquids in adult surgical patients. </font>
```{r complicateMetaDichotFast, include = TRUE,  fig.width = 10, fig.height = 4, fig.align = "center"}
## (updated 2021/01/22 15:17) complicateMetaDichotFast --------------------
meta.dat <- complicate_meta.dat %>% 
  filter(!is.na(n_wplclr)) %>% 
  filter(e_wplclr + e_choall != 0)

complicate_meta <- metabin(e_choall, n_choall, e_wplclr, n_wplclr,
  data = meta.dat,
  studlab = study,
  # byvar = cho_prot, # no cho/prot studies
  sm = "OR",
  method = "Inverse",
  digits = 2)

forest(complicate_meta,
  comb.fixed = FALSE,
  lab.e = "CHO     ",
  lab.c = "Fasting    ",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  # xlim = c(.002, 2),
  # at = c(0.01, 0.1, .4,  1, 2, 2),
  print.subgroup.labels = FALSE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = TRUE,
  pooled.events = TRUE,
  xlab = "Favors CHO           Favors Fasting")
  
figure_n <- fig_inc()
```
<br>


## Residual Gastric Volume

<br>

<font size = 4> Table `r table_n`. Residual gastric volumes measured by aspiration at induction in randomized controlled trials of adult surgical patients according to fasting, liquid and volume. </font>

```{r choRgv, include = FALSE}
## (updated 2021/01/19 19:20) choRgv --------------------------------------
rgv.dat <- contin.dat %>%
  filter(refid %in% cho_refids$refid) %>%
  select(refid:age, arm_n, arm_tx, timeingest1, amtingest1, timeingest2, amtingest2, type_ingest_1, starts_with("rgv"), notes_continuous) %>%
  filter(!is.na(rgv_us) | !is.na(rgv_imag) | !is.na(rgv_asp)) %>%
  # filter_at(vars(rgv_time_1:rgv_pval_2), any_vars(!is.na(.))) %>% # same
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6)) %>%  # Oyama PM
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  filter(surg_nosurg == "surgical") %>% 
  # select(refid, study, hr_2, hr_26, hr_gt6, timeingest1, amtingest1, timeingest2, amtingest2, age, design)
  mutate(
    study = ifelse(study == "Oyama 2011" & grepl("AM", notes_continuous), "Oyama 2011 (AM)^a^", study),
    study = ifelse(study == "Oyama 2011" & grepl("PM", notes_continuous), "Oyama 2011 (PM)^a^", study),
    rgv_type_meas = case_when(
      rgv_type_meas == "aspiration" ~ "Asp",
      rgv_type_meas == "ultrasound" ~ "US",
      rgv_type_meas == "imaging" ~ "MRI"),
    rgv_iqr_low_1 = ifelse(rgv_iqr_low_1 >= 10, round_0(rgv_iqr_low_1), round_1(rgv_iqr_low_1)),
    rgv_iqr_up_1 = ifelse(rgv_iqr_up_1 >= 10, round_0(rgv_iqr_up_1), round_1(rgv_iqr_up_1)),
    rgv_iqr = str_c("(", rgv_iqr_low_1, "-", rgv_iqr_up_1, ")"),
    rgv_range = str_c("(", round_0(rgv_range_low_1), "-", round_0(rgv_range_up_1), ")"),
    rgv_range = na_if(rgv_range, "(NA-NA)"),
    rgv_mean = ifelse(!is.na(rgv_sd_1) & !is.na(rgv_mean_1), str_c(round_1d(rgv_mean_1), " (", round_1d(rgv_sd_1), ")"), round_1d(rgv_mean_1)),
    # Oyama, Ajuzieogu to no digits
    rgv_mean = ifelse(refid %in% c(3588, 1768), str_c(round_0d(rgv_mean_1), " (", round_0d(rgv_sd_1), ")"), rgv_mean),
    rgv_mean = na_if(rgv_mean, "  NA"),
    rgv_mean = str_replace(rgv_mean, "\\(NA\\)", ""),
    rgv_mean = str_replace(rgv_mean, "^\\s", ""),
    rgv_mean = str_replace(rgv_mean, "\\( ", "\\("),
    rgv_med = str_c(round(rgv_median_1, 0), rgv_iqr, sep = " "),
    rgv_bar = ifelse(!is.na(rgv_mean_1), rgv_mean_1, rgv_median_1)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx) %>%
  group_by(study) %>%
  mutate(
    id = row_number(),
    study = ifelse(id > 1, NA, study),
    rgv_type_meas = ifelse(id > 1, NA, rgv_type_meas)) %>%
  ungroup() %>%
  select(refid, age, design, surg_nosurg, study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, rgv_type_meas, rgv_time_1, rgv_med, rgv_mean, rgv_bar)

cho_row <- rgv.dat %>%
  mutate(line = row_number()) %>%
  filter(grepl("CHO", arm_tx)) %>%
  pull(line)

# standardize to 0 to 30
cts30_format <- function(x) (x/30)
cts1_format <- function(x) (x)

rgv_surg <- rgv.dat %>%
  mutate(rgv_bar = case_when(
    grepl("CHO", rgv.dat$arm_tx) & age == "Adult" ~ color_bar("darksalmon", fun = cts30_format)(formattable::percent(rgv_bar)),
    !grepl("CHO", rgv.dat$arm_tx) & age == "Adult" ~ color_bar("lightgray", fun = cts30_format)(formattable::percent(rgv_bar)),
    grepl("CHO", rgv.dat$arm_tx) & age == "Pediatric" ~ color_bar("darksalmon", fun = cts1_format)(formattable::percent(rgv_bar)),
    !grepl("CHO", rgv.dat$arm_tx) & age == "Pediatric" ~ color_bar("lightgray", fun = cts1_format)(formattable::percent(rgv_bar))
  )) %>%
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, rgv_time_1, rgv_med, rgv_mean, rgv_bar) %>%
  mutate(
    rgv_bar = str_replace(rgv_bar, ">.*<", ">&nbsp;<"),
    rgv_time_1 = ifelse(rgv_time_1 == 0.0, round_0d(rgv_time_1), rgv_time_1),
    hr_26 = round(hr_26, digits = 0)
  )
    
```

```{r rgvKable, echo = FALSE}
## (updated 2020/12/15 08:32) rgvKable ------------------------------------
rgv_surg %>%
  kable(booktabs = T, align = c("llccccclll"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "Liquid", "N",  "> 6", "6 → 2", "≤ 2", "(hr)", "Med (IQR)", "M (SD)", "\\ \\ M or Med (0-30)")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "RGV (mL)" = 3), line = TRUE) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>%
  kable_styling(bootstrap_options = opt_boot) %>%
  row_spec(cho_row, color = "brown") %>%
  column_spec(1, width = "8em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(c(3:6), width = "2em") %>%
  column_spec(7, width = "3em") %>%
  column_spec(8, width = "3em") %>%
  column_spec(9, width = "3em") %>%
  column_spec(10, width = "4em") %>%
  pack_top(., "Adult, Surgical", 1, 37) %>%
  pack_sub(., "RCT", 1, 31) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 32, 37) %>%
  pack_top(., "Pediatric, Surgical", 38, 41) %>%
  pack_rows("RGV (mL/kg) \\ \\ \\ (0-1)", 38, 41, label_row_css = "padding-left:81%", bold = FALSE) %>%
  pack_sub(., "RCT", 38, 41) %>%
  footnote(general = "RGV: residual gastric volumne; M: mean; Med: median; IQR: interquartile range; CHO: carbohydrate; Prot: protein; RCT: randomized controlled trial; Asp: aspiration.",
    alphabet = c("Time measured relative to induction (time 0)."),
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

### &nbsp;&nbsp; Pooled (adult RCTs) 

<br>

<font size = 4> Figure `r figure_n`. Pooled residual gastric volume from randomized trials comparing carbohydrate drinks with fasting in adult surgical patients. </font>

```{r rgvChoMeta, include = TRUE, include = TRUE,  fig.width = 10, fig.height = 4.5, fig.align = "center"}
## (updated 2021/01/22 15:19) rgvChoMeta ----------------------------------
rgv_meta.dat <- contin.dat %>%
  arrange(design, year, study) %>% 
  filter(refid %in% cho_refids$refid, surg_nosurg == "surgical") %>%
  filter(arm_tx == "Fasting" | grepl("CHO", arm_tx)) %>%
  filter(!is.na(rgv_us) | !is.na(rgv_imag) | !is.na(rgv_asp)) %>%
  filter(design == "rct", age == "Adult") %>% 
  select(refid, study, year, design, arm_n, arm_tx, rgv_mean_1, rgv_sd_1, rgv_median_1:rgv_iqr_up_1) %>% 
  # Yilmaz 2013 estimate sd smd.bwgrpS(21.85, 19.15, 20, 20, .77), 
  # Yildiz 2013 smd.bwgrpS(18.1, 9.3, 30, 30, .05)
  # Wang 2019 smd.bwgrpS(24.86, 29.63, 37, 36, .238)
  mutate(rgv_sd_1 = ifelse(refid == 2985, 29.0, rgv_sd_1),
         rgv_sd_1 = ifelse(refid == 3154, 17.0, rgv_sd_1))%>% 
  arrange(refid, arm_tx) %>% 
  filter(arm_tx != "CHO/Prot", study != "Gianotti 2018", study != "deANascimento 2014") 

rgv_meta.dat <- left_join(rgv_meta.dat[c(1,3,5,7,9,11,13,15,17,19), ], rgv_meta.dat[c(2,4,6,8,10,12,14,16,18,20), ], 
                          by = c("refid", "study", "year"))
  
rgv_meta <- metacont(n.e = arm_n.x, n.c = arm_n.y, 
         median.e = rgv_median_1.x, 
         mean.e = rgv_mean_1.x,
         sd.e = rgv_sd_1.x,
         q1.e = rgv_iqr_low_1.x, 
         q3.e = rgv_iqr_up_1.x,
         min.e = rgv_range_low_1.x,
         max.e = rgv_range_up_1.x,
         mean.c = rgv_mean_1.y,
         sd.c = rgv_sd_1.y,
         median.c = rgv_median_1.y, 
         q1.c = rgv_iqr_low_1.y, 
         q3.c = rgv_iqr_up_1.y,
         min.c = rgv_range_low_1.y,
         max.c = rgv_range_up_1.y,
         data = rgv_meta.dat,
         studlab = study)

forest(rgv_meta, 
       comb.random = FALSE,
       lab.e = "CHO     ",
       lab.c = "Fasting     ",
       digits = 1,
       digits.sd = 1,
       digits.tau2 = 1,
       overall.hetstat = TRUE,
       print.I2.ci = TRUE,
       print.byvar = FALSE,
       overall = TRUE,
       fs.xlab = 11,
       xlab = "RGV (mL)\n Favors CHO           Favors Fasting")

figure_n <- fig_inc()

```

<br>



<hr style="height:2px;border-width:0;color:gray;background-color:gray">

<br>


# **Study/Participant Detail** 
## Study Characteristics 

<font size = 4> Table `r table_n`. Characteristics of 29 included studies examining carbohydrate drinks. </font>

```{r createStudyCharTable, include = FALSE} 
## (updated 2021/01/12 09:30) createStudyCharTable ------------------------
study_char_table <- study_char_cho.dat %>%
  mutate(
    dates = str_c(date_start, "-", date_end),
    country = countrycode::countryname(country, destination = "iso3c"),
    low_r = noquote(if_else(non_vh_hdi == "yes", "\U2022", "", "")),
    n = n_enrolled,
    n_anal = n_analyze,
    pilot = noquote(if_else(pilot == "yes", "\U2022", "", "")),
    study = ifelse(grepl("Marquini", study), str_c(study, "^a^"), study),
    setting = case_when(
      !is.na(hospital) ~ "Hosp",
      !is.na(ambulatory) ~ "Amb",
      !is.na(oth_setting) ~"Other"),
    gen = noquote(if_else(!is.na(general), "\U2022", "", "")),
    reg = noquote(if_else(!is.na(regional), "\U2022", "", "")),
    sed = noquote(if_else(!is.na(sedation), "\U2022", "", "")),
    registered = noquote(if_else(registered == "yes", "\U2022", "", "")),
    surg = case_when(
      str_detect(surg_type, "[Gg]yn|[Hh]ysterectomy") ~ "Gyn",
      str_detect(surg_type, "craniotomy") ~ "Neurosurgical",
      str_detect(surg_type, "maxillofacial") ~ "Maxillofacial",
      str_detect(surg_type, "[Hh]ernia|herniorrhaphy") ~ "Herniorrhaphy",
      str_detect(surg_type, "prostatectomy") ~ "prostatectomy",
      str_detect(surg_type, "ariety") ~ "Various",
      str_detect(surg_type, "various|Hirschsprung's") ~ "Various",
      str_detect(surg_type, "CABG|[Cc]oronary artery bypass surgery") ~ "CABG",
      str_detect(surg_type, "[Cc]olorectal|[Bb]owel|colon resection") ~ "Colorectal",
      str_detect(surg_type, "[Tt]hyroid|hip joint") ~ "Thyroid",
      str_detect(surg_type, "[Oo]rthopedic|discectomy") ~ "Orthopedic",
      str_detect(surg_type, "total hip or total knee replacement|[Tt]otal hip|[Tt]otal knee|Hip joint|hip replacement") ~ "TKA/THA",
      str_detect(surg_type, "cholecystectomy") ~ "Cholecystectomy",
      str_detect(surg_type, "[Gg]ast|Bowel") ~ "Other GI",
      str_detect(surg_type, "not appli") ~ "None (healthy)",
      str_detect(surg_type, "oral") ~ "Oral",
      str_detect(surg_type, "minor") ~ "Misc minor",
      str_detect(surg_type, "None") ~ "None (healthy)",
      str_detect(surg_type, "abdomin") ~ "Other GI",
      str_detect(surg_type, "[Cc]esarean|labor") ~ "Cesarean/vaginal birth",
      str_detect(surg_type, "thoracotomy") ~ "Thoracic",
      str_detect(surg_type, "healthy") ~ "None (healthy)",
      str_detect(surg_type, "Elective") ~ "Elective",
      str_detect(surg_type, "adenotonsillectomy") ~ "Adenotonsillectomy",
      str_detect(surg_type, "[Bb]reast") ~ "Breast",
      str_detect(surg_type, "Endso|endoscopic|colonoscopy") ~ "Endoscopic")) %>%
  # filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  select(study, dates, country, n, pilot, setting, gen, reg, sed, surg, registered)

```

```{r studyCharKable, echo = FALSE} 
## (updated 2021/01/12 19:27) ---------------------------------------------
study_char_table %>%
  kbl(booktabs = T, align = c("lcccccccclc"), 
      # format = "latex",
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Dates", "Country", " (N\\) ", "Pilot", 
                    "Setting", "Gen", "Reg", "Sed", "Type of Surgery", "Registered")) %>%
  add_header_above(c(" " = 3, "Enrolled" = 1, " " = 2, "Anesthetic" = 3, " " = 2)) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>% 
  # column_spec(2, width = "2em") %>% 
  pack_top(., "Adult, Surgical", 1, 92) %>% 
  pack_sub(., "RCT", 1, 80) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 81, 88) %>% 
  pack_sub(., "Prospective Cohort", 88, 89) %>%
  pack_sub(., "Retrospective Cohort", 90, 90) %>% 
  pack_sub(., "Case-control", 91, 91) %>% 
  pack_sub(., "Before-after", 92, 92) %>% 
  pack_top(., "Adult, Non-surgical", 93, 105) %>% 
  pack_sub(., "RCT", 93, 94) %>%
  pack_sub(., "Crossover", 95, 103) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 104, 105) %>% 
  pack_top(., "Pediatric, Surgical", 106, 112) %>% 
  pack_sub(., "RCT", 106, 110) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 111, 111) %>% 
  pack_sub(., "Prospective Cohort", 112, 112) %>% 
  pack_top(., "Pediatric, Non-surgical", 113, 115) %>% 
  pack_sub(., "RCT", 113, 113) %>%
  pack_sub(., "Crossover", 114, 114) %>%
  pack_sub(., "Prospective Cohort", 115, 115) %>% 
  footnote(general_title = "",
    general = "Gen: general; Reg: regional; Sed: sedation; Hosp: hospital; Amb: ambulatory; TKA: total knee arthroplasty; THA: total hip arthroplasty.",
    alphabet = c("Multiple publications from the same study."),
    footnote_as_chunk = FALSE) # %>% 

table_n <- tab_inc()
```

<br><br>

## Sample Characteristics 

<font size = 4> Table `r table_n`. Characteristics of patients in included studies. </font>

```{r createPtCharTable, include = FALSE}
## (updated 2021/01/12 09:29) createPtCharTable ---------------------------
pt_char_table <- study_arm_cho.dat %>%
  group_by(refid) %>%
  summarize(
    N = sum(arm_n),
    wgt = arm_n / N,
    asai_all = round(sum(asai * wgt, na.rm = TRUE)),
    asaii_all = round(sum(asaii * wgt, na.rm = TRUE)),
    asaiii_all = round(sum(asaiii * wgt, na.rm = TRUE)),
    asai_ii_all = round(sum(asai_ii * wgt, na.rm = TRUE)),
    age_mn_all = round(sum(age_mean * wgt, na.rm = TRUE)),
    age_md_all = round(sum(age_med * wgt, na.rm = TRUE)),
    sex_all = round(sum(female * wgt, na.rm = TRUE)),
    white_all = round(sum(white * wgt, na.rm = TRUE)),
    black_all = round(sum(black * wgt, na.rm = TRUE)),
    asian_all = round(sum(asian * wgt, na.rm = TRUE)),
    bmi_mn_all = round(sum(bmi_mean * wgt, na.rm = TRUE)),
    bmi_md_all = round(sum(bmi_med * wgt, na.rm = TRUE)),
    dm_mn_all = round(sum(dm * wgt, na.rm = TRUE)),
    neuro_all = round(sum(neuro * wgt, na.rm = TRUE))) %>%
  filter(row_number() == 1) %>%
  ungroup()

# add study age, surg_nosurg, design
temp <- left_join(study_names, study_char.dat[, c("refid", "age", "surg_nosurg", "design")], by = "refid")
  
pt_char_table <- left_join(pt_char_table, temp, by = "refid") %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  mutate(study = ifelse(grepl("Marquini", study), str_c(study, "^a^"), study)) %>% 
  select(design, study, year, everything())

rm(temp)

pt_char_table <- pt_char_table %>% 
  # filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  select(study, N, asai_all, asaii_all, asai_ii_all, asaiii_all, sex_all, age_mn_all, 
  age_md_all, white_all, black_all, asian_all, bmi_mn_all, bmi_md_all, dm_mn_all)

```

```{r ptCharKable, echo = FALSE}
## (updated 2021/01/12 09:29) ptCharKable ---------------------------------
pt_char_table %>% 
  mutate_at(vars(asai_all:dm_mn_all), na_if, 0) %>% 
  kbl(
    booktabs = T, align = c("lrrrrcccccccccc"),
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Analyzed", "I", "II", "I-II", "III", "(%)",
      "Mean", "Med", "White", "Black", "Asian", "Mean", "Med", "DM (%)")) %>%
  add_header_above(c(" " = 1, "N" = 1, "\\ \\ \\ ASA Classs (%)" = 4, "Female" = 1, "Age" = 2,
    "Race (%)" = 3, "BMI (kg/m^2^)" = 2, " " = 1), line = TRUE) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>%
  # column_spec(2, width = "4em") %>%
  column_spec(3, width = "3em") %>%
  pack_top(., "Adult, Surgical", 1, 92) %>% 
  pack_sub(., "RCT", 1, 80) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 81, 88) %>% 
  pack_sub(., "Prospective Cohort", 88, 89) %>%
  pack_sub(., "Retrospective Cohort", 90, 90) %>% 
  pack_sub(., "Case-control", 91, 91) %>% 
  pack_sub(., "Before-after", 92, 92) %>% 
  pack_top(., "Adult, Non-surgical", 93, 105) %>% 
  pack_sub(., "RCT", 93, 94) %>%
  pack_sub(., "Crossover", 95, 103) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 104, 105) %>% 
  pack_top(., "Pediatric, Surgical", 106, 112) %>% 
  pack_sub(., "RCT", 106, 110) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 111, 111) %>% 
  pack_sub(., "Prospective Cohort", 112, 112) %>% 
  pack_top(., "Pediatric, Non-surgical", 113, 115) %>% 
  pack_sub(., "RCT", 113, 113) %>%
  pack_sub(., "Crossover", 114, 114) %>%
  pack_sub(., "Prospective Cohort", 115, 115) %>% 
  footnote(alphabet = c("Multiple publications from he same study."),
    general = "Med: median",
    general_title = "",
    footnote_as_chunk = T
  )
table_n <- tab_inc()
```

<br><br>

## Fasting, Liquid Timing and Amounts 

<font size = 4> Table `r table_n`. Liquid consumption prior to surgery or outcome measurement and amounts according to study arm. </font>

```{r createFastingTable, include = FALSE, echo = FALSE}
## (updated 2021/01/12 09:29) createFastingTable --------------------------
fasting_table <- study_arm_cho.dat %>%
  filter(refid %in% cho_refids$refid) %>%
  # mutate(tx = str_replace(arm_tx, "_", " ")) %>%
  # mutate(tx = str_to_title(tx)) %>%
  # mutate(tx = if_else(tx == "Cho", "CHO", tx, "")) %>%
  mutate(
    arm = ifelse(refid == 3588 & arm_n == 35, 3, arm),
    arm = ifelse(refid == 3588 & arm_n == 27, 2, arm),
    fastsolid = ifelse(fastsolid == 99, 12, fastsolid),
    timeingest1 = ifelse(timeingest1 == 99, 12, timeingest1),
    fastliquid = round_0(fastliquid),
    fastliquid = na_if(fastliquid, "NA"),
    amtingest1 = round(amtingest1, 0),
    amtingest1 = na_if(amtingest1, 0),
    timeingest1 = round(timeingest1, 0),
    timeingest2 = round(timeingest2, 0)) %>%
  select(refid, study, year, arm_tx, arm_n, fastsolid, fastliquid, type_of_liquid, timeingest1, amtingest1, timeingest2, amtingest2, age, surg_nosurg, design) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx) %>%
  select(study, arm_tx, arm_n, fastsolid, fastliquid, contains("ingest")) %>% 
  group_by(study) %>% 
  # mutate(year = ifelse(row_number() == 1, as.numeric(year), "")) %>% 
  mutate(study = ifelse(study == "Marquini 2020a", "Marquini 2020a,b,c", study)) %>% 
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  mutate(study = if_else(row_number() == 1, study, ""))

# study arms
study_arm.dat %>% 
  filter(refid %in% cho_refids$refid) %>% 
  group_by(refid) %>% 
  count(refid)

```

```{r fastingKable, echo = FALSE}
## (updated 2021/01/12 09:27) fastingKable --------------------------------
fasting_table %>%
  kbl(booktabs = T, align = c("llccccccc"),
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "\\ \\ Liquid", "N", "Solids", "Liquids",  "Time^a^ (hr)", "Amount (mL)", 
      "Time^a^ (hr)", "Amount (mL)")) %>%
  add_header_above(c(" " = 3, "Prescribed Fasting  (hr)" = 2, "Treat Liquid 1" = 2, "Treat Liquid 2" = 2), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>% 
  # column_spec(2, width = "5em") %>% 
  # column_spec(3, width = "9em") %>%
  pack_top(., "Adult, Surgical", 1, 189) %>% 
  pack_sub(., "RCT", 1, 189) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 190, 206) %>%
  pack_sub(., "Prospective Cohort", 207, 208) %>%
  pack_sub(., "Retrospective Cohort", 209, 210) %>% 
  pack_sub(., "Case-control", 211, 212) %>% 
  pack_sub(., "Before-after", 213, 214) %>% 
  pack_top(., "Adult, Non-surgical", 215, 245) %>% 
  pack_sub(., "RCT", 215, 219) %>%
  pack_sub(., "Crossover", 220, 240) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 241, 245) %>% 
  pack_top(., "Pediatric, Surgical", 246, 260) %>% 
  pack_sub(., "RCT", 246, 257) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 258, 259) %>% 
  pack_sub(., "Prospective Cohort", 260, 260) %>% 
  pack_top(., "Pediatric, Non-surgical", 261, 266) %>% 
  pack_sub(., "RCT", 261, 263) %>%
  pack_sub(., "Crossover", 264, 265) %>%
  pack_sub(., "Prospective Cohort", 266, 266) %>% 
  footnote(general = "hr: hours; ch: cholecystectomy; cr: colorectal; gen: general; epi: epidural",
          alphabet = c("In surgical studies hours prior to surgery. In non-surgical studies time 0 reference for any measurements and negative numbers prior ingestion."),
          alphabet_title = " ",
          general_title = "",
          footnote_as_chunk = T)

table_n <- tab_inc()
```

<br><br>

## Carbohydrate Drink Amounts

<font size = 4> Table `r table_n`. Composition of carbohydrate liquids and brands. </font>

```{r createChoDrinkTable, include = FALSE}
## (updated 2021/01/12 09:27) createChoDrinkTable -------------------------
# calculate total cho/protein
cho_drink_table <- study_arm_cho.dat %>%
  filter(arm_tx %in% c("CHO/Prot", "CHO")) %>%
  mutate(
    amtingest2 = replace_na(amtingest2, 0),
    tot_vol = amtingest2 + amtingest1,
    prot_conc = round(prot_conc, 1),
    prot_gm_all = round(prot_conc * tot_vol / 100, 1),
    cho_gm_all = round(cho_conc * tot_vol / 100, 1),
    cho_gm_all = round(ifelse(is.na(cho_gm_all), cho_gm, cho_gm_all), 0),
    prot_gm_all = ifelse(is.na(prot_gm_all), protein_gm, prot_gm_all)) %>% 
  select(refid, study, year, arm_tx, arm, cho_gm, cho_conc, protein_gm, prot_gm_all, prot_conc, brand, tx_detail, age, surg_nosurg, design, cho_gm_all, prot_gm_all, prot_conc)

cho_drink_table <- cho_drink_table %>% 
  mutate(cho_conc = ifelse(refid == 1228 & arm == 2, "0.5 gm/kg", cho_conc),
         cho_conc = ifelse(refid == 1228 & arm == 3, "1.0 gm/kg", cho_conc),
         cho_conc = ifelse(refid == 1228 & arm == 4, "1.5 gm/kg", cho_conc)) %>% 
  group_by(study) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  mutate(study = ifelse(row_number() >= 2, " ", study),
         study = ifelse(study == "Marquini 2020a", "Marquini 2020 (all)", study)) %>% 
  ungroup() %>% 
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  select(study, cho_conc, prot_conc, cho_gm_all, prot_gm_all, brand, tx_detail)

```

```{r choDrinksKable, echo = FALSE}
## (updated 2021/01/12 09:28) choDrinksKable ------------------------------
library(formattable)
cho_drink_table <- cho_drink_table %>% 
  mutate(cho_gm_all = replace_na(cho_gm_all, ""),
         prot_gm_all = replace_na(prot_gm_all, ""))

prot_gm_scale <- function(x) (x/200)
cho_gm_scale <- function(x) (x/200)
cho_drink_table$cho_gm_all <- color_bar("lightgreen", fun = cho_gm_scale)(cho_drink_table$cho_gm_all)
cho_drink_table$prot_gm_all <- color_bar("lightgreen", fun = prot_gm_scale)(cho_drink_table$prot_gm_all)

cho_drink_table$prot_gm_all <- str_replace(cho_drink_table$prot_gm_all, "direction: rtl; ", "")
cho_drink_table$cho_gm_all <- str_replace(cho_drink_table$cho_gm_all, "direction: rtl; ", "")

#cho_drink_table$cho_gm_all <- normalize_bar(color = "lightgreen", na.rm = TRUE)(cho_drink_table$cho_gm_all)
#cho_drink_table$prot_gm_all <- normalize_bar("lightgreen", na.rm = TRUE)(cho_drink_table$prot_gm_all)

cho_drink_table %>% 
  select(-tx_detail) %>% 
  kbl(booktabs = T, align = c("llllll"),
      col.names = linebreak(c("\\ \\ \\ \\ \\ \\ \\ Author", "CHO, g", "Protein, g", "CHO, g", "Protein, g", "Brand")), escape = FALSE) %>%
  add_header_above(c(" " = 1, "Per 100 mL" = 2, "Total" = 2, " " = 1), line = TRUE) %>%  
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "10em") %>% 
  column_spec(c(2,3), width = "3em") %>% 
  column_spec(c(4,5), width = "5em") %>% 
  column_spec(6, width = "9em") %>%
  pack_top(., "Adult, Surgical", 1, 106) %>% 
  pack_sub(., "RCT", 1, 91) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 92, 101) %>% 
  pack_sub(., "Prospective Cohort", 102, 103) %>%
  pack_sub(., "Retrospective Cohort", 104, 104) %>% 
  pack_sub(., "Case-control", 105, 105) %>% 
  pack_sub(., "Before-after", 106, 106) %>% 
  pack_top(., "Adult, Non-surgical", 107, 132) %>% 
  pack_sub(., "RCT", 107, 108) %>%
  pack_sub(., "Crossover", 109, 127) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 128, 132) %>% 
  pack_top(., "Pediatric, Surgical", 133, 141) %>% 
  pack_sub(., "RCT", 133, 139) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 140, 140) %>% 
  pack_sub(., "Prospective Cohort", 141, 141) %>% 
  pack_top(., "Pediatric, Non-surgical", 142, 144) %>% 
  pack_sub(., "RCT", 142, 142) %>%
  pack_sub(., "Crossover", 143, 143) %>%
  pack_sub(., "Prospective Cohort", 144, 144) %>% 
  footnote(general = "CHO: carbohydrate; g: grams; Osm: osomolality; Glut: glutamine; Arg: arginine; NS: not specified",
          #alphabet = c("per 100/mL if not otherwise specified"),
          # alphabet_title = " ",
          general_title = "",
          footnote_as_chunk = T)  

table_n <- tab_inc()
```

<br>

## Funding 

<font size = 4> Table `r table_n`. Reported funding sources. </font>

```{r createFundingTable, include = FALSE}
## (updated 2021/01/12 09:28) createFundingTable --------------------------
study_fund_table <- study_char_cho.dat %>%
  mutate(
    # sponsor_desc = str_to_title(sponsor_desc),
    registered = noquote(if_else(registered == "yes", "\U2022", "", "")),
    public = noquote(if_else(funding == "public" | funding == "pub_indus", "\U2022", "", "")),
    industry = noquote(if_else(funding == "pub_indus", "\U2022", "", "")),
    none = noquote(if_else(funding == "none", "\U2022", "", "")),
    not_reported = noquote(if_else(funding == "NR", "\U2022", "", "")),
    study = ifelse(study == "Marquini 2020a", "Marquini 2020 (all)", study)) %>%
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  select(study, design, registered, public, industry, none, not_reported, sponsor_desc)

temp <- cho_drink_table %>% 
  select(study, brand) %>% 
  distinct()

study_fund_table <- left_join(study_fund_table, temp, by = "study") 

```

```{r fundingKable, echo = FALSE}
## (updated 2021/01/12 09:28) fundingKable --------------------------------
study_fund_table %>% 
  select(-design, -registered) %>% 
  kbl(booktabs = T, align = c("lcccclll"),
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "Public", "Industry", "None", 
                    "Not Reported", "Funding description", "Brand")) %>%
  add_header_above(c(" " = 1, "Reported Funding Source(s)" = 4, " " = 2), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "16em") %>% 
  column_spec(c(2,3,4,5), width = "4em") %>% 
  column_spec(6, width = "23em") %>%
  pack_top(., "Adult, Surgical", 1, 90) %>% 
  pack_sub(., "RCT", 1, 78) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 79, 86) %>% 
  pack_sub(., "Prospective Cohort", 86, 87) %>%
  pack_sub(., "Retrospective Cohort", 88, 88) %>% 
  pack_sub(., "Case-control", 89, 89) %>% 
  pack_sub(., "Before-after", 90, 90) %>% 
  pack_top(., "Adult, Non-surgical", 91, 103) %>% 
  pack_sub(., "RCT", 91, 92) %>%
  pack_sub(., "Crossover", 93, 101) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 102, 103) %>% 
  pack_top(., "Pediatric, Surgical", 104, 110) %>% 
  pack_sub(., "RCT", 104, 108) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 109, 109) %>% 
  pack_sub(., "Prospective Cohort", 110, 110) %>% 
  pack_top(., "Pediatric, Non-surgical", 111, 113) %>% 
  pack_sub(., "RCT", 111, 111) %>%
  pack_sub(., "Crossover", 112, 112) %>%
  pack_sub(., "Prospective Cohort", 113, 113)
  #footnote(general = "g: grams; Osm: osmolality",
          # alphabet = c("Hours prior to surgery"),
          # alphabet_title = " ",
          # general_title = "",
          # footnote_as_chunk = T)

table_n <- tab_inc()
```

<br>

# References 

<br>


