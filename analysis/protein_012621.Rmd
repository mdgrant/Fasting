---
title: "Protein/Carbohydrate Containing Drinks"
date: "`r format(Sys.time(), '%d %B, %Y (%H:%M)')`"
output:
  html_document:
    font: Source Sans Pro
    theme: cosmo
    anchor_sections: TRUE 
    toc: yes
    toc_depth: 3
    toc_float: 
      collapsed: no
      smooth_scroll: yes
    linkcolor: black
bibliography: protein.bib
csl: jama.csl
link-citations: yes
workflowr:
  suppress_report: TRUE
nocite: '@*'
---

#### 

```{=html}
<style type="text/css">
  body{
  font-size: 9.5pt;
  font-family: Source Sans Pro;
}

.list-group-item.active, .list-group-item.active:hover, .list-group-item.active:focus {
  color: #090909;
  background-color: #0909093d;
}

.lightable-classic.lightable-hover tbody tr:hover {
    background-color: #c5d4e4;
}
.btn-xs, .btn-group-xs>.btn { 
display: none; 
}

.btn-default {
display: none !important; 
}
</style>
```
```{r setupData, include = FALSE}
## (updated 2021/01/06 11:34) preliminaries -------------------------------
# functions
now <- function() {str_replace_all(format(Sys.time(), "%m %d %y_%H-%M"), " ", "_")}
# replace_mg <- function(a, b) {if_else(is.na(a) & !is.na(b), b, a)}
tab_inc <- function() {
  table_n <- table_n + 1
  table_n}
fig_inc <- function() {
  figure_n <- figure_n + 1
  figure_n}
table_n <- 1
figure_n <- 1

## get current files; select protein refids; directory must have unique ####
source("code/readFiles_120220_wfr.R")

# add study protein indicator "tx"
study_char.dat <- left_join(study_char.dat, protein_refids, by = "refid") 
study_arm.dat  <- left_join(study_arm.dat, protein_refids, by = "refid") 

# study char protein refs 
study_char_prot.dat <- study_char.dat %>% 
  filter(tx == "protein") 

# study arm protein refs 
study_arm_prot.dat <- study_arm.dat %>% 
  filter(tx == "protein")

## dichot factor treatment arm outcome type for ordering (updated 2020/12/12 12:04) ####
# save dichot.dat 
dichot_all.dat <- dichot.dat
dichot.dat <- dichot.dat %>% 
  filter(refid %in% protein_refids$refid) %>% 
  # factor arm_tx levels for protein studies
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "other_clear",
    "other",
    "cho",
    "milk",
    "protein"))) %>%
  mutate(tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Clear = "other_clear",
    Other = "other",
    CHO = "cho",
    Milk = "milk",
    "Prot/CHO" = "protein"),
    arm_tx = tx) %>%
  select(-tx)

## contin factor treatment arm outcome type for ordering (updated 2020/12/12 12:04) ####
# save contin.dat
contin_all.dat <- contin.dat
contin.dat <- contin.dat %>% 
  filter(refid %in% protein_refids$refid) %>% 
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "other_clear",
    "other",
    "cho",
    "milk",
    "protein"))) %>%
  mutate(tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Clear = "other_clear",
    Other = "other",
    CHO = "cho",
    Milk = "milk",
    "Prot/CHO" = "protein"),
    arm_tx = tx) %>%
  select(-tx)

## likert factor treatment arm outcome type for ordering (updated 2020/12/12 12:04) ####
# save likert
likert_all.dat <- likert.dat
# likert.dat <- likert_all.dat
likert.dat <- likert.dat %>% 
  filter(refid %in% protein_refids$refid) %>% 
  # factor arm_tx levels for protein studies
  mutate(tx = factor(arm_tx,
  levels = c(
    "fasting",
    "water",
    "placebo",
    "other",     
    "other_clear",
    "cho", 
    "milk",
    "protein")), 
  tx = fct_recode(tx,
    Fasting = "fasting",
    Water = "water",
    Placebo = "placebo",
    Other = "other",     
    Clear = "other_clear",
    CHO = "cho",
    Milk = "milk",
    "Prot/CHO" = "protein"),
    arm_tx = tx) %>%
  select(-tx)
```

# Included Studies

<br>

<font size = 4> Table `r table_n`. Number of included studies according to age, surgery, and design. </font>

```{r}
## (updated 2021/01/25 21:33) number included -----------------------------
study_char_prot.dat %>%
  select(age, design, surg_nosurg) %>% 
  tabyl(design, surg_nosurg, age) %>% 
  adorn_totals("row") %>% 
  data.frame() %>% 
  as_tibble() %>% 
  select(c(1:3,5,6)) %>% 
  `colnames<-`(c("design", "nonsurg_adult", "surg_adult",  "nonsurg_peds", "surg_peds")) %>% 
  select(design, surg_adult, nonsurg_adult, surg_peds, nonsurg_peds) %>% 
  filter(!design %in% c("case_series", "cluster", "prospect_coh", "casecontrol", "case_series", "other")) %>% 
  mutate(
    design = case_when(
      design == "rct" ~ "RCT",
      design == "crossover" ~ "Crossover",
      design == "cluster" ~ "Cluster",
      design == "nrsi" ~ "Nonrandomized",
      design == "prospect_coh" ~ "Prospective Cohort",
      design == "retrospect_coh" ~ "Retrospective Cohort",
      design == "Total" ~ "Total")) %>% 
  kbl(
    booktabs = T, align = c("lcccc"), col.names = c("Design", "Surgical^a^", "Non-surgical", "Surgical", "Non-surgical")) %>%
  add_header_above(c(" " = 1, "Adult" = 2, "Pediatric" = 2), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "12em") %>%  
  column_spec(c(2:5), width = "8em") %>% 
  row_spec(5, bold = TRUE) %>% 
  footnote(general = "RCT: randomized controlled trial",
           alphabet = c("Includes 1 endoscopy study."),
           general_title = "", 
           footnote_as_chunk = FALSE)
table_n <- tab_inc()
```

<br>

<font size = 4> Table `r table_n`. Included studies according to design, age, centers, country, type of surgery or procedure, and design (see [References](#references) for citations). </font>

```{r studiesIncluded, echo = FALSE, include = TRUE}
## (updated 2020/12/13 09:53) studiesIncluded -----------------------------
# list of studies, age, surgical/non surgical, design
study_char_prot.dat %>%
  mutate(
    surg = case_when(
      str_detect(surg_type, "[Gg]yn") ~ "Gyn",
      str_detect(surg_type, "ariety") ~ "Various",
      str_detect(surg_type, "various") ~ "Various",
      str_detect(surg_type, "total hip or total knee replacement") ~ "TKA/THA",
      str_detect(surg_type, "cholecystectomy") ~ "Cholecystectomy",
      str_detect(surg_type, "[Gg]ast|Bowel") ~ "Other GI",
      str_detect(surg_type, "not appli") ~ "None (healthy)",
      str_detect(surg_type, "oral") ~ "Oral",
      str_detect(surg_type, "minor") ~ "Misc minor",
      str_detect(surg_type, "None") ~ "None (healthy)",
      str_detect(surg_type, "abdomin") ~ "Other GI",
      str_detect(surg_type, "Endso") ~ "Endoscopy"),
    country = ifelse(grepl("USA", country), "USA", country),
    country = ifelse(grepl("UK", country), "UK", country),
    country = ifelse(!is.na(non_vh_hdi), str_c(country, "^a^"), country),
    n_analyze = ifelse(refid == 2009, 9, n_analyze),
    study = ifelse(grepl("Marquini", study), str_c(study, "^b^"), study),
    surg = ifelse(surg_nosurg == "nonsurgical", "None", surg)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  select(refid, study, n_analyze, centers, country, surg) %>%
  kbl(
    booktabs = T, align = c("llccll"), # format = "latex",
    col.names = c("\\ \\ \\ \\ \\ \\ \\ \\ ID", "Study", "Analyzed (N)", "Centers", "Country^a^", "Surgery")) %>%
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "6em") %>%  
  column_spec(2, width = "10em") %>%  
  column_spec(3, width = "6em") %>%  
  column_spec(4, width = "6em") %>%  
  column_spec(5, width = "10em") %>%  
  column_spec(6, width = "12em") %>%  
  pack_top(., "Adult, Surgical", 1, 19) %>%
  pack_sub(., "RCT", 1, 19) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 20, 21) %>%
  pack_sub(., "Retrospective Cohort", 22, 22) %>%
  pack_top(., "Adult, Nonsurgical", 23, 23) %>%
  pack_sub(., "RCT", 23, 23) %>%
  pack_sub(., "Crossover", 24, 29) %>%
  pack_top(., "Pediatric, Nonsurgical", 30, 30) %>%
  pack_sub(., "RCT", 30, 30) %>%
  footnote(
    alphabet = c(
      "Non very high [Human Development Index](https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index) country."),
      "Multiple publications of the same study.",
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

```{r studiesOutcomes, echo = FALSE, include = FALSE}
## (updated 2020/12/13 09:54) studiesOutcomes -----------------------------
# <font size = 4> Table `r table_n`. Outcomes reported in included studies. </font>
# list of studies, age, surgical/non surgical, design
study_char_prot.dat %>%
  mutate(across(out_emptying:out_bp, ~ ifelse(!is.na(.), "\U2022", NA))) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  select(study, out_emptying:out_bp) %>%
  kbl(
    booktabs = T, align = c("lccccccccccc"), # format = "latex",
    col.names = c("\\ \\ \\ \\ \\ \\ \\ \\ Study", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ")) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>%
  kable_styling(bootstrap_options = opt_boot) %>%
  pack_top(., "Adult, Surgical", 1, 19) %>%
  pack_sub(., "RCT", 1, 19) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 20, 21) %>%
  pack_sub(., "Retrospective Cohort", 22, 22) %>%
  pack_top(., "Adult, Nonsurgical", 23, 23) %>%
  pack_sub(., "RCT", 23, 23) %>%
  pack_sub(., "Crossover", 24, 29) %>%
  pack_top(., "Pediatric, Nonsurgical", 30, 30) %>%
  pack_sub(., "RCT", 30, 30) %>%
  footnote(
    alphabet = c("Multiple publications of the same study."),
    general_title = "",
    footnote_as_chunk = FALSE)

#  table_n <- tab_inc()
```

<br><br>

<hr style="height:2px;border-width:0;color:gray;background-color:gray">

# Patient Reported Outcomes

## Surgical/Endoscopy Studies

<br>

### *Hunger 

<br>

<!-- occurrence -->

<font size = 4> Table `r table_n`. Occurrence of hunger according to fasting, liquid and volume. </font>

```{r dichotProtData, include = FALSE}
## (updated 2020/12/13 09:55) dichotProtData ------------------------------
# dichot_prot_studies <- dichot.dat %>% group_by(refid) %>% slice(1) 
# timeingest1 = ifelse(timeingest1 == 99, 12, timeingest1), timeingest2 = ifelse(timeingest2 == 99, 12, timeingest2),
dichot_prot.dat <- dichot.dat %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6)) %>%  # Oyama PM
    # for nonsurgical
    # hr_0 = 0, hr_minus2 = 0,
    # hr_0 =      if_else(surg_nosurg != "surgical" & timeingest1 ==  0, amtingest1, hr_0, missing = 0),
    # hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest1 == -2, amtingest1, hr_minus2, missing = 0),
    # hr_0 =      if_else(surg_nosurg != "surgical" & timeingest2 ==  0, amtingest1, hr_0, missing = 0),
    # hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest2 == -2, amtingest1, hr_minus2, missing = 0)) %>% 
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  filter(surg_nosurg == "surgical") %>% 
  # select(refid, study, hr_2, hr_26, hr_gt6, timeingest1, amtingest1, timeingest2, amtingest2, age, design)
  mutate(
    hunger_np = n_percent(hunger_n, hunger_per),
    thirst_np = n_percent(thirst_n, thirst_per),
    nausea_np = n_percent(nausea_n, nausea_per),
    vomit_np = n_percent(vomit_n, vomit_per),
    comfort_np = n_percent(arm_n - comfort_n, 100 - comfort_per),
    satisfac_np = n_percent(satisfac_n, satisfac_per),
    complicate_np = n_percent(complicate_n, complicate_per),
    hypotension_np = n_percent(hypotension_n, hypotension_per),
    regurg_np = n_percent(regurg_n, regurg_per),
    rgv_gt25_np = n_percent(rgv_gt25_n, rgv_gt25_per),
    ph_lt25_np = n_percent(ph_lt25_n, ph_lt25_per),
    aspirate_np = n_percent(aspirate_n, aspirate_per),
    vomit_np = ifelse(refid == 6446 & arm_n == 40, "4 (10)", vomit_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx, arm) %>%
  select(refid, study, year, age, design, surg_nosurg, arm, arm_n, arm_tx, hr_gt6, hr_26, hr_2, time_outcome, hunger_np:aspirate_np, compl_descript, out_dichot_notes, ends_with("_n"), timeingest1, amtingest1, timeingest2, amtingest2, ends_with("per")) %>%
  filter_at(vars(hunger_np:aspirate_np), any_vars(!is.na(.)))

## dichot_prot_htnvr all not used except for debugging ---------------------
dichot_prot_htnvr <- dichot_prot.dat %>%
  select(refid:time_outcome, hunger_np, thirst_np, nausea_np, vomit_np, regurg_np, satisfac_np) %>%
  filter_at(vars(hunger_np, thirst_np, nausea_np, vomit_np, regurg_np, satisfac_np), any_vars(!is.na(.))) %>%
  select(!c(year, age, surg_nosurg), study, arm_n:vomit_np) %>%
  mutate(
    arm_tx = as.character(arm_tx),
    arm_tx = ifelse(grepl("Marquini", study) & arm_tx != "Prot/CHO", "Water^c^", arm_tx)) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup()
```

```{r hungerTableOr, include = TRUE}
## (updated 2021/01/12 09:42) hungerTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_hunger_or <- dichot_prot.dat %>% 
  filter(!is.na(hunger_np)) %>%
  select(refid, study, arm_tx, arm_n, hunger_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_hunger <- with(or_join(dichot_hunger_or, "hunger"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))
```

```{r hungerTable, include = TRUE}
## (updated 2021/01/12 18:04) hungerTable ---------------------------------
dichot_hunger <- dichot_prot.dat %>% 
  filter(!is.na(hunger_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, hunger_np, hunger_per, hunger_n)

dichot_hunger <- left_join(dichot_hunger, or_hunger, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(hunger_per = round(hunger_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, hunger_np, hunger_per, or_ci)

prot_row <- dichot_hunger %>%
  mutate(line = row_number()) %>%
  filter(grepl("Prot", arm_tx)) %>%
  pull(line)

dichot_hunger$hunger_bar <- 0
dichot_hunger$hunger_bar <- ifelse(grepl("Prot", dichot_hunger$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_hunger$hunger_per),
  color_bar("lightgray", fun = dichot_format)(dichot_hunger$hunger_per))

dichot_hunger  <- dichot_hunger %>% 
  add_foot(study, "Koeppe 2013", "b") %>% 
mutate(hunger_bar = str_replace(hunger_bar, ">[0-9][0-9]", ">&nbsp;"))
  
dichot_hunger %>% 
  select(!c(refid, arm, design, age, hunger_per)) %>% 
  select(study:hunger_np, hunger_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6→2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Fasting")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Hunger" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4:6), width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "5em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "8em") %>% 
  row_spec(prot_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 2) %>% 
  pack_sub(., "RCT", 1, 2) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("At time of endocoscopy = 0",
           "'Did you feel hunger during the fasting period?'"),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()

```

<br>

<!-- likert -->

<font size = 4> Table `r table_n`. Comparative hunger ratings in included studies (surgical and nonsurgical) according to fasting, liquid and volume. </font>

```{r hungerLikert, include = TRUE}
# no subgroup data
likert_prot_hung.dat <- likert.dat %>%
  filter(refid %in% protein_refids$refid) %>%
  filter(hunger_l == "hunger_l") %>%
  # filter_at(vars(hunger_m:hunger_pval), any_vars(!is.na(.))) # same
  select(refid:age, arm_n, arm_tx, likert_time_outcome, contains("ingest"), starts_with("hunger")) %>%
  mutate(arm_tx = droplevels(arm_tx)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx)

likert_prot_hung_kbl.dat <- likert_prot_hung.dat %>%
  rename(time_outcome = likert_time_outcome) %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    # FOR Du Rct add new header in table after RCT
    hr_2 =   if_else(timeingest1 == 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6),  # Oyama PM
    arm_tx = as.character(arm_tx),
    arm_tx = ifelse(study == "Du 2017" & arm_tx == "Clear", "Juice^e^", arm_tx),
    arm_tx = ifelse(study == "Marquini 2020c" & arm_tx == "Clear", "Water^c^", arm_tx)) %>%
    # for nonsurgical
    # hr_0 = 0, hr_minus2 = 0,
    # hr_0 =      if_else(surg_nosurg != "surgical" & timeingest1 ==  0, amtingest1, hr_0, missing = 0),
    # hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest1 == -2, amtingest1, hr_minus2, missing = 0),
    # hr_0 =      if_else(surg_nosurg != "surgical" & timeingest2 ==  0, amtingest1, hr_0, missing = 0),
    # hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest2 == -2, amtingest1, hr_minus2, missing = 0)) %>%
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  # Footnote: distilled water, 4 drops red dye, 2 drops sucrose
  select(refid:arm_tx, hr_gt6, hr_26, hr_2, time_outcome, hunger_scale, hunger_m:hunger_iqru) %>%
  #mutate(0
  #  time_outcome = ifelse(time_outcome == 0 & refid != 1315, "Preop", time_outcome),
  #  time_outcome = ifelse(suppressWarnings(!is.na(as.numeric(time_outcome))) & refid != 1315,
  #    str_c("Postop ", time_outcome, " hrs"), time_outcome),
  #  time_outcome = ifelse(refid == 1315, str_c("At ", time_outcome, " hrs"), time_outcome)) %>%
  mutate(
    hunger_med = paste0(hunger_med, " (", hunger_iqrl, "-", hunger_iqru, ")"),
    hunger_med = ifelse(hunger_med == "NA (NA-NA)", NA, hunger_med),
    hunger_med = gsub(" \\(NA-NA\\)", "", hunger_med),
    ranges = str_c("(", hunger_rl, "-", hunger_ru, ")"),
    mn_95_ci = str_c(round_1(hunger_m), " (", round_1(hunger95l), "-", round_1(hunger95u), ")"),
    mn_95_ci = ifelse(mn_95_ci == "NA (NA-NA)", NA, mn_95_ci),
    # NOTE: footnote e: Hunger Satiety Scale
    hunger_scale = ifelse(hunger_scale == "VAS: 0 to 100", "0→100", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 0 to 100", "0→100", hunger_scale),
    hunger_scale = ifelse(hunger_scale == "VAS, 0 to 10", "0→10", hunger_scale),
    hunger_scale = ifelse(refid == 3588, "1→5 NRS", hunger_scale),
    hunger_scale = ifelse(refid == 1315, "5→1 HSS^f^", hunger_scale),
    hunger_med = ifelse(grepl("(AM)", study) & arm_tx == "Fasting", str_c(hunger_med, "^d^"), hunger_med),
    hunger_med = ifelse(grepl("(PM)", study) & arm_tx == "Fasting", str_c(hunger_med, "^d^"), hunger_med)) %>%
  # remove second line study identifier
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    hunger_scale = ifelse(row_number() == 1, hunger_scale, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup()
```

```{r hungerAdultSurgKable, echo = FALSE}
## (updated 2020/12/13 13:48) hungerAdultSurgKable ------------------------
protein_row <- likert_prot_hung_kbl.dat %>%
  mutate(line = row_number()) %>%
  filter(arm_tx == "Prot/CHO") %>%
  pull(line)

likert_prot_hung_kbl.dat %>%
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, time_outcome, hunger_scale, mn_95_ci, hunger_med, ranges) %>%
  add_row(study = NA, arm_tx = NA, arm_n = NA, hr_gt6 = NA, hr_26 = NA, hr_2 = NA, time_outcome = NA, hunger_scale = NA, mn_95_ci = NA, hunger_med = NA, ranges = NA) %>% 
  kbl(booktabs = T, align = c("llccccclll"), escape = FALSE,
      col.names = c(
        "\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N",  "> 6", "6→2", "≤ 2", "Time (hr)^a^", "Scale^b^", "M (95% C)",
        "Med (IQR)", "Range")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Hunger Rating\n *(Between-group Comparison)*" = 5), line = TRUE) %>%
  # NOTE: footnote a: includes at 2.5 hours
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "8em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(3, width = "2em") %>%
  column_spec(c(4:6), width = "2em") %>%
  column_spec(7, width = "5em") %>%
  column_spec(8, width = "4em") %>%
  column_spec(9, width = "5em") %>%
  column_spec(10, width = "5em") %>%
  column_spec(11, width = "4em") %>% 
  row_spec(protein_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 6) %>%
  pack_sub(., "RCT", 1, 6) %>%
  pack_rows("P = 0.001; MD^g^\\ ≈ -31.1 (95% CI, -36.9 to -25.3)", 3, 3, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("MD^g^\\ ≈ -11.2 (95% CI, -21.9 to -0.4)", 5, 5, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  pack_rows("2-hr post-op MD 2.8 (95% CI, -8.1 to 13.7)", 5, 5, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  pack_rows("P = 0.4; MD^h^ -1.8 (95% CI, -2.0, -1.5)", 7, 7, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  pack_rows("MD^g^\\ ≈ 0.5 (95% CI, -1.1 to 2.1)", 9, 9, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("MD^g^\\ ≈ 1.0 (95% CI, -0.4 to 2.4)", 11, 11, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  pack_rows("CHO vs. apple juice or milk, p=0.78", 14, 14, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  pack_sub(., "Nonrandomized Studies of Interventions", 7, 10) %>%
  pack_top(., "Pediatric, Nonsurgical (age 8-14 years)", 11, 13) %>%
  pack_rows("0 hr", 11, 13, label_row_css = "padding-left:45%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE) %>%
  footnote(
    general = "RCT: randomized controlled trial; M: mean; Med: median; IQR: interquartile range; NRS: numeric rting scale.",
    alphabet = c(
      "When outcome assessed relative to surgery where 0 is prior to induction and other values hours postop or rlative to liquids in nonsurgical studies.",
      "Arrow (→) indicates best to worst hunger (all visual analogue except Du 2017 and Oyama 2011).",
      "Distilled water, 4 drops red dye, 2 drops sucrose.",
      "Range as reported but apparent error being <1 or >5.",
      "Apple juice.",
      "Hunger Satiety Scale.",
      "Estimated using reported medians, IQRs, and ranges.",
      "Calculated from means and confidence intervals."),
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>

### *Thirst 

<br>

<!-- occurrence -->

<font size = 4> Table `r table_n`. Occurrence of thirst according to fasting, liquid and volume. </font>

```{r thirstTableOr, include = TRUE}
## (updated 2021/01/12 09:42) hungerTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_thirst_or <- dichot_prot.dat %>% 
  filter(!is.na(thirst_np)) %>%
  select(refid, study, arm_tx, arm_n, thirst_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_thirst <- with(or_join(dichot_thirst_or, "thirst"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))
```

```{r thirstTable, include = TRUE}
## (updated 2021/01/12 18:04) thirstTable ---------------------------------
dichot_thirst <- dichot_prot.dat %>% 
  filter(!is.na(thirst_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, thirst_np, thirst_per, thirst_n)

dichot_thirst <- left_join(dichot_thirst, or_thirst, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(thirst_per = round(thirst_per, 0)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, thirst_np, thirst_per, or_ci)

prot_row <- dichot_thirst %>%
  mutate(line = row_number()) %>%
  filter(grepl("Prot", arm_tx)) %>%
  pull(line)

dichot_thirst$thirst_bar <- 0
dichot_thirst$thirst_bar <- ifelse(grepl("Prot", dichot_thirst$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_thirst$thirst_per),
  color_bar("lightgray", fun = dichot_format)(dichot_thirst$thirst_per))

dichot_thirst  <- dichot_thirst %>% 
  add_foot(study, "Koeppe 2013", "b") %>% 
mutate(thirst_bar = str_replace(thirst_bar, ">[0-9][0-9]", ">&nbsp;"))
  
dichot_thirst %>% 
  select(!c(refid, arm, design, age, thirst_per)) %>% 
  select(study:thirst_np, thirst_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6→2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Fasting")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Thirst" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "9em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4:6), width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "5em") %>% 
  column_spec(9, width = "5em") %>% 
  column_spec(10, width = "8em") %>% 
  row_spec(prot_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 2) %>% 
  pack_sub(., "RCT", 1, 2) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("At time of endocoscopy = 0",
           "Report of thirst.'"),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()

```

<!-- Likert -->

<br>

<font size = 4> Table `r table_n`. Comparative thirst ratings according to fasting, liquid and volume. </font>

```{r thirstAdultSurg, echo = FALSE}
## (updated 2020/12/14 05:50) thirstLikData -------------------------------
# no subgroup data, all surgical
likert_prot_thirst.dat <- likert.dat %>%
  rename(time_outcome = likert_time_outcome) %>%
  filter(refid %in% protein_refids$refid) %>%
  filter(thirst_l == "thirst_l") %>%
  # filter_at(vars(thirst_m:thirst_pval), any_vars(!is.na(.))) # same
  select(refid:age, arm_n, arm_tx, time_outcome, contains("ingest"), starts_with("thirst")) %>% 
  mutate(arm_tx = droplevels(arm_tx)) %>% 
  arrange(study, arm_tx) %>% 
  group_by(study) %>% mutate(arm = row_number()) %>% ungroup() %>% 
  arrange(age, desc(surg_nosurg), design, year, study)

## (updated 2020/12/14 09:51) thirstAdultSurg -----------------------------
likert_prot_thirst_kbl.dat <- likert_prot_thirst.dat %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    # FOR Du Rct add new header in table after RCT
    # hr_2 =   if_else(timeingest1 == 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6)) %>%  # Oyama PM
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  mutate(
    arm_tx = as.character(arm_tx),
    arm_tx = ifelse(refid == 247 & arm_n == 42, str_c(arm_tx, "^d^"), arm_tx),
    arm_tx = ifelse(study == "Marquini 2020c" & arm_tx == "Clear", "Water^c^", arm_tx),
    # NOTE: footnote c: distilled water, 4 drops red dye, 2 drops sucrose
    iqrs = str_c("(", round_1(thirst_iqrl), "-", round_1(thirst_iqru), ")"),
    thirst_med = paste(round_1(thirst_med), iqrs),
    ranges = str_c("(", thirst_rl, "-", thirst_ru, ")"),
    mn_95_ci = str_c(round_1(thirst_m), " (", round_1(thirst95l), "-", round_1(thirst95u), ")"),
    mn_95_ci = ifelse(mn_95_ci == "NA (NA-NA)", NA, mn_95_ci),
    iqrs = ifelse(iqrs == "NA (NA-NA)", NA, iqrs),
    thirst_med = gsub(" \\(NA-NA\\)", "", thirst_med),
    thirst_scale = ifelse(refid == 1315, "5→1^g^", thirst_scale),
    # thirst_scale = ifelse(refid == 1315, str_c(thirst_scale, "HSS^e^ 1 to 5"), thirst_scale),
    # NOTE: footnote e: thirst Satiety Scale
    thirst_scale = ifelse(thirst_scale == "VAS (0-10)", "0→10", thirst_scale),
    thirst_scale = ifelse(thirst_scale == "VAS: 0 to 100", "0→100", thirst_scale),
    thirst_scale = ifelse(thirst_scale == "VAS, 0 to 100", "0→100", thirst_scale),
    thirst_scale = ifelse(thirst_scale == "VAS, 0 to 10", "0→10", thirst_scale),
    thirst_scale = ifelse(thirst_scale == "NRS, 1 to 5", "1→5 NRS", thirst_scale),
    thirst_med = ifelse(refid == 3588 & arm_n %in% c(33, 26), str_c(thirst_med, "^d^"), thirst_med)) %>%
  select(refid:arm_tx, hr_gt6, hr_26, hr_2, time_outcome, thirst_scale, mn_95_ci, thirst_med, ranges) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    thirst_scale = ifelse(row_number() == 1, thirst_scale, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup()

```

```{r thirstAdultSurgKable, echo = FALSE}
## (updated 2020/12/14 09:51) thirstAdultSurgKable ------------------------
protein_row <- likert_prot_thirst_kbl.dat %>%
  mutate(line = row_number()) %>%
  filter(arm_tx == "Prot/CHO") %>%
  pull(line)

likert_prot_thirst_kbl.dat %>%
  # select(!c(refid, arm:age)) %>%
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, time_outcome, thirst_scale, mn_95_ci, thirst_med, ranges) %>%
  add_row(study = NA, arm_tx = NA, arm_n = NA, hr_gt6 = NA, hr_26 = NA, hr_2 = NA, time_outcome = NA, thirst_scale = NA, mn_95_ci = NA, thirst_med = NA, ranges = NA) %>% 
  kbl(booktabs = T, align = c("llccccclll"), escape = FALSE,
      col.names = c(
        "\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N",  "> 6", "6→2", "≤ 2", "Time (hr)^a^", "Scale^b^", "M (95% CI)",
        "Med (IQR)", "Range")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Thirst Rating\n *(Between-group Comparison)*" = 5), line = TRUE) %>%
  # NOTE: footnote a: includes at 2.5 hours
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "8em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(3, width = "2em") %>%
  column_spec(c(4:6), width = "2em") %>%
  column_spec(7, width = "5em") %>%
  column_spec(8, width = "4em") %>%
  column_spec(9, width = "5em") %>%
  column_spec(10, width = "5em") %>%
  column_spec(11, width = "4em") %>% 
  row_spec(protein_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 13) %>%
  pack_sub(., "RCT", 1, 9) %>%
  pack_rows("Differences between groups not detected", 4, 4, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%  
  pack_rows("P = 0.01; MD^e^≈\\ -13.3 (95% CI, -16.4 to -10.2)", 6, 6, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("MD^e^≈\\ -10.6 (95% CI, -24.6 to 3.4)", 8, 8, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("2-hr post-op MD -3.1 (95% CI, -15.8 to 9.5)", 8, 8, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("P = 0.01, MD^f^≈\\ -2.8 (95% CI, -3.0 to -2.6)", 10, 10, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 10, 13) %>%
  pack_rows("dMD^e^≈\\ -0.5 (95% CI, -2.1 to 1.1)", 12, 12, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("≈MD^e^\ -1.0 (95% CI, -2.2 to 0.2)", 14, 14, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  footnote(general = "RCT: randomized controlled trial; M: mean; Med: median; IQR: interquartile range; NRS: numeric rating scale.",
    alphabet = c("Relative to surgery where 0 is prior to induction and other values hours postop.",
      "Arrow (→) indicates least to worst VAS unless otherwise noted.",
      "Distilled water, 4 drops red dye, 2 drops sucrose.",
      "Range as reported but apparent error being <1.",
      "Estimated using reported medians, IQRs, and ranges.",
      "Calculated from means and confidence intervals."),
    general_title = "",
    footnote_as_chunk = FALSE)

# TODO; note likert thirst outcomes not pooled due to timing of outcome assessment
rm(protein_row)
table_n <- tab_inc()
```

### *Nausea 

<br>

<font size = 4> Table `r table_n`. Occurrence of nausea according to fasting, liquid and volume. </font>

<br>

```{r nauseaTableOr, include = TRUE}
## (updated 2021/01/12 09:42) nauseaTableOr -------------------------------
dichot_format <- function(x) (x/100)

# odds ratios
# exclude single arm studies
# select refid, study, arm_tx, arm_n, outcome_n
dichot_nausea_or <- dichot_prot.dat %>% 
  filter(!is.na(nausea_np)) %>%
  select(refid, study, arm_tx, arm_n, nausea_n) %>% 
  group_by(refid) %>% 
  filter(n() > 1)

or_nausea <- with(or_join(dichot_nausea_or, "nausea"), odds_ratio(event_e, n_e, event_c, n_c, refid = refid, digits = 2))
```

```{r nauseaTable, include = TRUE}
## (updated 2021/01/12 18:04) nauseaTable ---------------------------------
dichot_nausea <- dichot_prot.dat %>% 
  filter(!is.na(nausea_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  select(refid:time_outcome, nausea_np, nausea_per, nausea_n)

dichot_nausea <- left_join(dichot_nausea, or_nausea, by = "refid") %>% 
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    or_ci = ifelse(row_number() == 1, or_ci, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() %>% 
  mutate(nausea_per = round(nausea_per, 0),
         or_ci = ifelse(or_ci == "NA (NA, NA)", NA, or_ci)) %>% 
  select(refid, arm, design, age, study, arm_n, arm_tx, starts_with("hr"), time_outcome, nausea_np, nausea_per, or_ci)

prot_row <- dichot_nausea %>%
  mutate(line = row_number()) %>%
  filter(grepl("Prot", arm_tx)) %>%
  pull(line)

dichot_nausea$nausea_bar <- 0
dichot_nausea$nausea_bar <- ifelse(grepl("Prot", dichot_nausea$arm_tx),
  color_bar("darksalmon", fun = dichot_format)(dichot_nausea$nausea_per),
  color_bar("lightgray", fun = dichot_format)(dichot_nausea$nausea_per))

dichot_nausea  <- dichot_nausea %>% 
  # add_foot(study, "Koeppe 2013", "b") %>% 
mutate(nausea_bar = str_replace(nausea_bar, ">\\d+", ">&nbsp;"))
  
dichot_nausea %>% 
  select(!c(refid, arm, design, age, nausea_per)) %>% 
  select(study:nausea_np, nausea_bar, or_ci) %>% 
  kbl(booktabs = T, align =  c("lclccccrlc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "\\ \\ \\ N", "Liquid", "> 6", "6→2", "≤ 2", "(hr)", "N (%)", " ", "CHO vs. Fasting")) %>% 
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Time^a^" = 1, "Nausea" = 2, "OR (95% CI)"), line = TRUE) %>% 
  kable_styling(bootstrap_options = opt_boot, position = "left") %>% 
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>% 
  column_spec(1, width = "10em") %>%  
  column_spec(2, width = "3em") %>% 
  column_spec(3, width = "4em") %>% 
  column_spec(c(4:6), width = "3em") %>% 
  column_spec(7, width = "3em") %>% 
  column_spec(8, width = "4em") %>% 
  column_spec(9, width = "7em") %>% 
  column_spec(10, width = "8em") %>% 
  row_spec(prot_row, color = "brown") %>% 
  pack_top(., "Adult, Surgical", 1, 2) %>% 
  pack_sub(., "RCT", 1, 15) %>%
  pack_sub(., "Retrospective Cohort", 16, 17) %>%
  footnote(general = "RCT: randomized controlled trial; OR: odds ratio; CHO: carbohydrate; Prot: protein.",
           alphabet = c("Relative to induction or start of endocoscopy."),
           general_title = "",  
           footnote_as_chunk = FALSE)

table_n <- tab_inc()

```

<br>

### &emsp; Pooled (adult RCTs) 

<br>

<font size = 4> Figure `r figure_n`. Pooled incidence of nausea --- randomized trials comparing protein-containing drinks with fasting in adult surgical patients. </font>
```{r nauseaMeta, echo = FALSE, fig.width = 10, fig.height = 4.5, fig.align = "center"}
## (updated 2020/12/13 09:57) nauseaMeta ----------------------------------
# data
nvra_meta.dat <- dichot_prot.dat %>% 
    mutate(
    time_outcome = ifelse(time_outcome == 0, "Preop", time_outcome),
    time_outcome = ifelse(suppressWarnings(!is.na(as.numeric(time_outcome))), str_c("Postop ", time_outcome, " hrs"), time_outcome)) %>% 
  select(refid, study, year, arm_tx, nausea_n, arm_n, design, time_outcome) %>% 
  filter(design == "rct", !is.na(nausea_n), arm_tx != "CHO") %>% 
  mutate(arm_tx = as.character(arm_tx)) %>% 
  select(!design) %>% 
  arrange(year)

nvra_meta.dat <- left_join(nvra_meta.dat[c(1, 3, 5, 7, 9, 11, 13), ],
  nvra_meta.dat[c(2, 4, 6, 8, 10, 12, 14), ],
  by = c("refid", "study", "year")) %>%
  filter(arm_tx.x == "Fasting") %>% 
  mutate(post_op = ifelse(time_outcome.y == "Preop", "Preop", "Postop")) %>% 
  select(-contains("time"))

nvra_meta <- metabin(nausea_n.y, arm_n.y, nausea_n.x, arm_n.x,
  studlab = study,
  data = nvra_meta.dat,
  sm = "OR",
  method = "Inverse",
  prediction = TRUE,
  hakn = TRUE,
  method.tau = "PM",
  byvar = post_op,
  digits = 2)

forest(nvra_meta,
  comb.fixed = FALSE,
  lab.e = "Prot/CHO",
  lab.c = "Fasting",
  digits = 2,
  digits.tau2 = 1,
  overall.hetstat = TRUE,
  print.I2.ci = TRUE,
  prediction = FALSE,
  fs.xlab = 11,
  print.subgroup.labels = TRUE,
  print.byvar = FALSE,
  test.subgroup = FALSE,
  subgroup = FALSE,
  pooled.events = TRUE,
  xlab = "Favors Protein              Favors Fasting")
  
figure_n <- fig_inc()
```

<br>

<br>

### *Pain 

<br>

<font size = 4> Table `r table_n`. Pain ratings according to fasting, liquid and volume. </font>

```{r comfortData, include = FALSE}
## (updated 2020/12/14` 14:32) comfortData ---------------------------------
# comfort studies
likert_prot_comfort.dat <- likert.dat %>%
  rename(time_outcome = likert_time_outcome) %>%
  filter(refid %in% protein_refids$refid, !is.na(comfort_l) | !is.na(pain_l)) %>%
  # filter_at(vars(thirst_m:thirst_pval), any_vars(!is.na(.))) # same
  select(refid:age, arm_n, arm_tx, time_outcome, contains("ingest"), starts_with(c("comfort", "pain")), out_l_notes) %>%
    mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 = if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    # FOR Du Rct add new header in table after RCT
    # hr_2 =   if_else(timeingest1 == 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6),  # Oyama PM
    arm_tx = droplevels(arm_tx)) %>%
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  mutate( # columns for table
    comfort95l = ifelse(is.na(comfort95l), conf_tl(comfort_m, comfort_sd, arm_n), comfort95l),
    comfort95u = ifelse(is.na(comfort95u), conf_tu(comfort_m, comfort_sd, arm_n), comfort95u),
    m_ci = ifelse(comfort_m >= 1,
      str_c(round_1(comfort_m), " (", round_1(comfort95l), "-", round_1(comfort95u), ")"),
      str_c(round_2(comfort_m), " (", round_2(comfort95l), "-", round_2(comfort95u), ")")),
    m_ci = gsub(" \\(NA-NA\\)", "", m_ci),
    med_iqr = str_c(comfort_med, " (", comfort_iqrl, "-", comfort_iqru, ")"),
    med_range = str_c("(", comfort_rl, "-", comfort_ru, ")")) %>% 
  arrange(year, study, arm_tx)
  
```

```{r comfortKable, echo = FALSE}
## (updated 2020/12/14 14:31) comfortKable --------------------------------
protein_row <- likert_prot_comfort.dat %>% 
  mutate(line = row_number()) %>% 
  filter(arm_tx == "Prot/CHO") %>% 
  pull(line)

likert_prot_comfort.dat %>%
  rename(scale_com = comfort_pain_scale) %>%
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, time_outcome, scale_com, m_ci, med_iqr) %>%
  add_row(study = NA, arm_tx = NA, arm_n = NA, hr_gt6 = NA, hr_26 = NA, hr_2 = NA, time_outcome = NA, scale_com = NA, m_ci = NA, med_iqr = NA) %>%
  mutate(
    scale_com = ifelse(grepl("QoR-40 (pain)", scale_com), "QoR-40 pain^c^", scale_com),
    # scale_com = ifelse(grepl("comfort", scale_com), "QoR-40^c^  12→60 ", scale_com),
    scale_com = ifelse(grepl("unspecified", scale_com), "VAS^d^  ?→? ", scale_com),
    scale_com = ifelse(grepl("abdominal", scale_com), "VAS^e^ 0→100 ", scale_com),
    scale_com = ifelse(grepl("0 to 100 \\(pain\\)", scale_com), "VAS 0→100", scale_com),
    scale_com = ifelse(grepl("Pain VAS, 0 to 10", scale_com), "VAS 0→10", scale_com),
    time_outcome = ifelse(study == "Helminen 2019", 2, time_outcome)) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    scale_com = ifelse(row_number() == 1, scale_com, NA)) %>%
  ungroup() %>%
  mutate(scale_com = ifelse(arm_tx == "CHO" & arm_n == 43, "35→5", scale_com)) %>% 
  kbl(booktabs = T, align = c("llccccclll"), escape = FALSE,
    col.names = c(
      "\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N",  "> 6", "6→2", "≤ 2", "Time (hr)^a^", "Scale^b^", "M (95% CI)",
      "Med (IQR)")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Pain\n *(Between-group Comparison)*" = 4), line = TRUE) %>%
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  column_spec(1, width = "10em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(3, width = "1em") %>%
  column_spec(c(4:6), width = "2em") %>%
  column_spec(7, width = "7em") %>%
  column_spec(8, width = "8em") %>%
  column_spec(9, width = "8em") %>%
  column_spec(10, width = "8em") %>%
  row_spec(protein_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 12) %>%
  pack_sub(., "RCT", 1, 12) %>%
  pack_rows("Between-group difference not detected, P = 0.49", 4, 4, label_row_css = "padding-left:60%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("MD 0.08 (95% CI, -0.70 to 0.86)", 6, 6, label_row_css = "padding-left:60%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
    pack_rows("Between-group difference not detected, P = 0.16", 9, 9, label_row_css = "padding-left:60%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("MD 0.03 (-0.10 to 0.17)", 11, 11, label_row_css = "padding-left:60%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  pack_rows("MD -1.92 (95% CI, -2.15 to -1.69)", 13, 13, label_row_css = "padding-left:60%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  #pack_rows("Comfort", 1, 3, label_row_css = "padding-left:76.5%", bold = TRUE) %>%
  #pack_rows("Pain", 4, 12, label_row_css = "padding-left:77.5%", bold = TRUE) %>%
  footnote(
    general = "RCT: randomized controlled trial; Med: median; IQR: interquartile range; NRS: numeric rating scale.",
    alphabet = c("Following surgery.",
      "Arrow (→) indicates best to worst.",
      "Quality of Recovery Score physical comfort domain.",
      "Did not state the range or direction of the visual analogue scale.",
      "Abdominal pain in women undergoing laparoscopic gastric bypass."),
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```

<br>


<br> 

### *Patient Satisfaction 

<br>

<font size = 4> Table `r table_n`. Patient satisfaction ratings according to fasting, liquid and volume. </font>

```{r satisLikert, include = TRUE}
## (updated 2021/01/29 08:30) satisLikert ---------------------------------
# no subgroup data
likert_prot_satis.dat <-  likert.dat %>%
  filter(refid %in% protein_refids$refid) %>%
  # delete Asakura as abstracted QoR emotional
  filter(pt_satis_l == "pt_satis_l", refid != 2234) %>%
  # filter_at(vars(satis_m:satis_pval), any_vars(!is.na(.))) # same
  select(refid:age, arm_n, arm_tx, likert_time_outcome, contains("ingest"), contains("satis")) %>%
  mutate(arm_tx = droplevels(arm_tx)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx)

likert_prot_satis_kbl.dat <- likert_prot_satis.dat %>%
  rename(time_outcome = likert_time_outcome) %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6),  # Oyama PM
    arm_tx = as.character(arm_tx),
    arm_tx = ifelse(study == "Du 2017" & arm_tx == "Clear", "Juice^e^", arm_tx),
    arm_tx = ifelse(study == "Marquini 2020c" & arm_tx == "Clear", "Water^c^", arm_tx)) %>%
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2"), condition = ~ .x == 0) %>%
  # Footnote: distilled water, 4 drops red dye, 2 drops sucrose
  select(refid:arm_tx, hr_gt6, hr_26, hr_2, time_outcome, satisfaction_scale, satis_m:satis_iqru) %>%
  mutate(
    satis_med = paste0(satis_med, " (", satis_iqrl, "-", satis_iqru, ")"),
    satis_med = ifelse(satis_med == "NA (NA-NA)", NA, satis_med),
    satis_med = gsub(" \\(NA-NA\\)", "", satis_med),
    ranges = str_c("(", satis_rl, "-", satis_ru, ")"),
    mn_95_ci = str_c(round_1(satis_m), " (", round_1(satis95l), "-", round_1(satis95u), ")"),
    mn_95_ci = ifelse(mn_95_ci == "NA (NA-NA)", NA, mn_95_ci),
    # NOTE: footnote e: satis Satiety Scale
    satisfaction_scale = ifelse(satisfaction_scale == "VAS, 0 to 10", "0→10", satisfaction_scale)) %>% 
  # remove second line study identifier
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  group_by(study) %>%
  mutate(
    study = ifelse(row_number() == 1, study, NA),
    satisfaction_scale = ifelse(row_number() == 1, satisfaction_scale, NA),
    time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup()
```

```{r satisAdultSurgKable, echo = FALSE}
## (updated 2021/01/29 08:30) satisAdultSurgKable -------------------------
protein_row <- likert_prot_satis_kbl.dat %>%
  mutate(line = row_number()) %>%
  filter(arm_tx == "Prot/CHO") %>%
  pull(line)

likert_prot_satis_kbl.dat %>%
  select(study, arm_tx, arm_n, hr_gt6, hr_26, hr_2, time_outcome, satisfaction_scale, mn_95_ci, satis_med, ranges) %>%
  add_row(study = NA, arm_tx = NA, arm_n = NA, hr_gt6 = NA, hr_26 = NA, hr_2 = NA, time_outcome = NA, satisfaction_scale = NA, mn_95_ci = NA, satis_med = NA, ranges = NA) %>% 
  kbl(booktabs = T, align = c("llcccccccc"), escape = FALSE,
      col.names = c(
        "\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N",  "> 6", "6→2", "≤ 2", "Time (hr)^a^", "Scale^b^", "M (95% C)",
        "Med (IQR)", "Range")) %>%
  add_header_above(c(" " = 3, "Volume (mL) Before Induction (hr)" = 3, "Satisfaction Rating\n *(Between-group Comparison)*" = 5), line = TRUE) %>%
  # NOTE: footnote a: includes at 2.5 hours
  kable_styling(bootstrap_options = opt_boot, position = "left") %>%
  kable_classic(full_width = FALSE, html_font = opt_font, position = "left", "hover") %>%
  column_spec(1, width = "8em") %>%
  column_spec(2, width = "4em") %>%
  column_spec(3, width = "2em") %>%
  column_spec(c(4:6), width = "2em") %>%
  column_spec(7, width = "3em") %>%
  column_spec(8, width = "3em") %>%
  column_spec(9, width = "6em") %>%
  column_spec(10, width = "5em") %>%
  column_spec(11, width = "5em") %>% 
  row_spec(protein_row, color = "brown") %>%
  pack_top(., "Adult, Surgical", 1, 2) %>%
  pack_sub(., "RCT", 1, 2) %>%
  pack_rows("P = 0.01; MD^e^\\ 1.76 (95% CI, 1.59 to 1.93)", 3, 3, label_row_css = "padding-left:65%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  #pack_rows("MD^g^\\ ≈ -11.2 (95% CI, -21.9 to -0.4)", 5, 5, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  #pack_rows("2-hr post-op MD 2.8 (95% CI, -8.1 to 13.7)", 5, 5, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  #pack_rows("P = 0.4; MD^h^ -1.8 (95% CI, -2.0, -1.5)", 7, 7, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  #pack_rows("MD^g^\\ ≈ 0.5 (95% CI, -1.1 to 2.1)", 9, 9, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>% 
  #pack_rows("MD^g^\\ ≈ 1.0 (95% CI, -0.4 to 2.4)", 11, 11, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  #pack_rows("CHO vs. apple juice or milk, p=0.78", 14, 14, label_row_css = "padding-left:70%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE, color = "gray", italic = TRUE) %>%
  #pack_sub(., "Nonrandomized Studies of Interventions", 7, 10) %>%
  #pack_top(., "Pediatric, Nonsurgical (age 8-14 years)", 11, 13) %>%
  #pack_rows("0 hr", 11, 13, label_row_css = "padding-left:45%; border-bottom: 0px solid;", underline = FALSE, bold = FALSE) %>%
  footnote(
    general = "RCT: randomized controlled trial; M: mean; Med: median; IQR: interquartile range.",
    alphabet = c(
      "When outcome assessed relative to surgery where 0 is prior to induction.",
      "Visual analogue scale with arrow (→) indicating low to high patient satisfaction.",
      "Distilled water, 4 drops red dye, 2 drops sucrose.",
      "Estimated using reported medians, IQRs, and ranges.",
      "Calculated from means and confidence intervals."),
    general_title = "",
    footnote_as_chunk = FALSE)

table_n <- tab_inc()
```


<br>

## Healthy Volunteer Studies

<br>

### *Nausea

<br>

<font size = 4> Table `r table_n`. Occurrence of nausea in crossover studies of adult healthy volunteers. </font>

```{r dichotNonsurg}
## (updated 2020/12/13 09:55) dichotProtData ------------------------------
# dichot_prot_studies <- dichot.dat %>% group_by(refid) %>% slice(1) 
# timeingest1 = ifelse(timeingest1 == 99, 12, timeingest1), timeingest2 = ifelse(timeingest2 == 99, 12, timeingest2),
dichot_prot_nonsurg.dat <- dichot.dat %>%
  mutate(
    # surgical studies (note none have times 0 or negative)
    # hr_2 is ≤ 2; hr_26 is (2, 6] >2 to 6; hr_gt6 is >6
    hr_2 = 0, hr_26 = 0, hr_gt6 = 0,
    hr_2 =   if_else(timeingest1 <= 2 & timeingest1 > 0, amtingest1, hr_2, missing = 0),
    hr_26 =  if_else(timeingest1 > 2 & timeingest1 < 6, amtingest1, hr_26, missing = 0),
    hr_gt6 = if_else(timeingest1 >= 6, amtingest1, hr_gt6, missing = 0),
    hr_2 =   if_else(hr_2 == 0 & timeingest2 <= 2 & timeingest2 > 0, amtingest2, hr_2, missing = 0),
    hr_26 =  if_else(hr_26 == 0 & timeingest2 > 2 & timeingest2 < 6, amtingest2, hr_26, missing = 0),
    hr_gt6 = if_else(hr_gt6 == 0 & timeingest2 >= 6, amtingest2, hr_gt6, missing = 0),
    hr_gt6 = if_else(grepl("also received 300", type_ingest_1), 500, hr_gt6),  # Oyama PM
    # for nonsurgical
    hr_0 = 0, hr_minus2 = 0,
    hr_0 =      if_else(surg_nosurg != "surgical" & timeingest1 ==  0, amtingest1, hr_0, missing = 0),
    hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest1 == -2, amtingest1, hr_minus2, missing = 0),
    hr_0 =      if_else(surg_nosurg != "surgical" & timeingest2 ==  0, amtingest1, hr_0, missing = 0),
    hr_minus2 = if_else(surg_nosurg != "surgical" & timeingest2 == -2, amtingest1, hr_minus2, missing = 0)) %>% 
  replace_with_na_at(.vars = c("hr_gt6", "hr_26", "hr_2", "hr_0", "hr_minus2"), condition = ~ .x == 0) %>%
  filter(surg_nosurg == "non-surgical") %>% 
  # select(refid, study, hr_2, hr_26, hr_gt6, timeingest1, amtingest1, timeingest2, amtingest2, age, design)
  mutate(
    hunger_np = n_percent(hunger_n, hunger_per),
    thirst_np = n_percent(thirst_n, thirst_per),
    nausea_np = n_percent(nausea_n, nausea_per),
    vomit_np = n_percent(vomit_n, vomit_per),
    comfort_np = n_percent(arm_n - comfort_n, 100 - comfort_per),
    satisfac_np = n_percent(satisfac_n, satisfac_per),
    complicate_np = n_percent(complicate_n, complicate_per),
    hypotension_np = n_percent(hypotension_n, hypotension_per),
    regurg_np = n_percent(regurg_n, regurg_per),
    rgv_gt25_np = n_percent(rgv_gt25_n, rgv_gt25_per),
    ph_lt25_np = n_percent(ph_lt25_n, ph_lt25_per),
    aspirate_np = n_percent(aspirate_n, aspirate_per),
    vomit_np = ifelse(refid == 6446 & arm_n == 40, "4 (10)", vomit_np)) %>%
  arrange(age, desc(surg_nosurg), design, year, study, arm_tx, arm) %>%
  select(refid, study, year, age, design, surg_nosurg, arm, arm_n, arm_tx, hr_gt6, hr_26, hr_2, time_outcome, hunger_np:aspirate_np, compl_descript, out_dichot_notes, ends_with("_n"), timeingest1, amtingest1, timeingest2, amtingest2, ends_with("per")) %>%
  filter_at(vars(hunger_np:aspirate_np), any_vars(!is.na(.)))
```


```{r dichotProtCrossKbl, include = TRUE}
## (updated 2020/12/13 09:57) dichotProtCrossKbl --------------------------
dichot_prot_cross <- dichot_prot_nonsurg.dat %>% 
  filter(design == "crossover") %>% 
  select(refid:arm_tx, timeingest1, amtingest1, time_outcome, nausea_np) %>% 
  rename(hr = amtingest1) %>% 
  select(!c(refid, year, age, design, surg_nosurg, arm, timeingest1)) %>% 
  group_by(study) %>%
  mutate(study = ifelse(row_number() == 1, study, NA),
         time_outcome = ifelse(row_number() == 1, time_outcome, NA)) %>%
  ungroup() 

protein_row <- dichot_prot_cross %>% 
  mutate(line = row_number()) %>% 
  filter(arm_tx == "Prot/CHO") %>% 
  pull(line)

dichot_prot_cross %>% 
  select(study, arm_tx, arm_n, hr, time_outcome, nausea_np) %>% 
  kbl(booktabs = T, align =  c("lllclc"), escape = FALSE,
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Liquid", "N","Ingested (mL)", "Time Assessed", "N (%)")) %>% 
  kable_styling(bootstrap_options = opt_boot, full_width = FALSE, position = "left") %>% 
  kable_classic(position = "left", full_width = FALSE, html_font = opt_font, "hover") %>% 
  column_spec(1, width = "10em") %>%  
  column_spec(2, width = "5em") %>% 
  column_spec(3, width = "2em") %>% 
  column_spec(4, width = "6em") %>% 
  column_spec(5, width = "9em") %>% 
  column_spec(6, width = "4em") %>% 
  row_spec(protein_row, color = "brown") %>% 
  pack_top(., "Adult, Nonsurgical", 1, 5) %>% 
  pack_sub(., "Crossover", 1, 5) %>% 
    footnote(
    general = "CHO: carbohydrate; Prot: protein",
    general_title = "",
    footnote_as_chunk = FALSE)

  table_n <- tab_inc()
```

<br><br>

# Clinical Outcomes

<br>

### Residual Gastric Volume

<br>

### pH

<br>

### RGV < 25 mL & pH > 2.5

<br>

### Regurgitation 

<br> 

### Vomiting 

<br>

### Complications

<br>

### Blood Pressure

<br>

### Length of Stay

<br>


### Aspiration 

<br> 

# *Study/Participant Detail 
## Study Characteristics 

<font size = 4> Table `r table_n`. Characteristics of 29 included studies examining protein-containing drinks. </font>

```{r createStudyCharTable, include = FALSE}
study_char_table <- study_char_prot.dat %>%
  mutate(
    dates = str_c(date_start, "-", date_end),
    country = countrycode::countryname(country, destination = "iso3c"),
    low_r = noquote(if_else(non_vh_hdi == "yes", "\U2022", "", "")),
    n = n_enrolled,
    n_anal = n_analyze,
    pilot = noquote(if_else(pilot == "yes", "\U2022", "", "")),
    study = ifelse(grepl("Marquini", study), str_c(study, "^a^"), study),
    setting = case_when(
      !is.na(hospital) ~ "Hosp",
      !is.na(ambulatory) ~ "Amb",
      !is.na(oth_setting) ~"Other"),
    gen = noquote(if_else(!is.na(general), "\U2022", "", "")),
    reg = noquote(if_else(!is.na(regional), "\U2022", "", "")),
    sed = noquote(if_else(!is.na(sedation), "\U2022", "", "")),
    registered = noquote(if_else(registered == "yes", "\U2022", "", "")),
    surg = case_when(
      str_detect(surg_type, "[Gg]yn") ~ "Gyn",
      str_detect(surg_type, "ariety") ~ "Various",
      str_detect(surg_type, "various") ~ "Various",
      str_detect(surg_type, "total hip or total knee replacement") ~ "TKA/THA",
      str_detect(surg_type, "cholecystectomy") ~ "Cholecystectomy",
      str_detect(surg_type, "[Gg]ast|Bowel") ~ "Other GI",
      str_detect(surg_type, "not appli") ~ "None (healthy)",
      str_detect(surg_type, "oral") ~ "Oral",
      str_detect(surg_type, "minor") ~ "Misc minor",
      str_detect(surg_type, "None") ~ "None (healthy)",
      str_detect(surg_type, "abdomin") ~ "Other GI",
      str_detect(surg_type, "Endso") ~ "Endoscopy")) %>%
  # filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  select(study, dates, country, n, pilot, setting, gen, reg, sed, surg, registered)

# study design numbers
# temp <- study_char_prot.dat %>% 
#   select(refid, study, year, design) %>% 
#   group_by(design) %>% 
#   summarise(n = n())
# 
# n_rct <-    pull(temp %>% filter(design == "RCT") %>% select(n))
# n_cross <-  pull(temp %>% filter(design == "Crossover") %>% select(n))
# n_nrsi <-   pull(temp %>% filter(design == "NRSI") %>% select(n))
# n_retCoh <- pull(temp %>% filter(design == "Retrospective Cohort") %>% select(n))
# 
# rm(temp)

```

```{r studyCharKable, echo = FALSE}
study_char_table %>%
  kbl(booktabs = T, align = c("lcccccccclc"), 
      # format = "latex",
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Dates", "Country", " (N\\) ", "Pilot", 
                    "Setting", "Gen", "Reg", "Sed", "Type of Surgery", "Registered")) %>%
  add_header_above(c(" " = 3, "Enrolled" = 1, " " = 2, "Anesthetic" = 3, " " = 2)) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>% 
  # column_spec(2, width = "2em") %>% 
  column_spec(3, width = "7em") %>%
  pack_top(., "Adult, Surgical", 1, 19) %>% 
  pack_sub(., "RCT", 1, 19) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 20, 21) %>% 
  pack_sub(., "Retrospective Cohort", 22, 22) %>% 
  pack_top(., "Adult, Nonsurgical", 23, 23) %>% 
  pack_sub(., "RCT", 23, 23) %>%
  pack_sub(., "Crossover", 24, 29) %>%
  pack_top(., "Pediatric, Nonsurgical", 30, 30) %>% 
  pack_sub(., "RCT", 30, 30) %>% 
  footnote(general_title = "",
    general = "Gen: general; Reg: regional; Sed: sedation; Hosp: hospital; Amb: ambulatory; TKA: total knee arthroplasty; THA: total hip arthroplasty.",
    alphabet = c("Multiple publications from the same study."),
    footnote_as_chunk = FALSE) # %>% 

table_n <- tab_inc()
```

<br><br>

## Sample Characteristics 

<font size = 4> Table `r table_n`. Characteristics of patients in included studies. </font>

```{r createPtCharTable, include = FALSE}
pt_char_table <- study_arm_prot.dat %>%
  group_by(refid) %>%
  summarize(
    N = sum(arm_n),
    wgt = arm_n / N,
    asai_all = round(sum(asai * wgt, na.rm = TRUE)),
    asaii_all = round(sum(asaii * wgt, na.rm = TRUE)),
    asaiii_all = round(sum(asaiii * wgt, na.rm = TRUE)),
    asai_ii_all = round(sum(asai_ii * wgt, na.rm = TRUE)),
    age_mn_all = round(sum(age_mean * wgt, na.rm = TRUE)),
    age_md_all = round(sum(age_med * wgt, na.rm = TRUE)),
    sex_all = round(sum(female * wgt, na.rm = TRUE)),
    white_all = round(sum(white * wgt, na.rm = TRUE)),
    black_all = round(sum(black * wgt, na.rm = TRUE)),
    asian_all = round(sum(asian * wgt, na.rm = TRUE)),
    bmi_mn_all = round(sum(bmi_mean * wgt, na.rm = TRUE)),
    bmi_md_all = round(sum(bmi_med * wgt, na.rm = TRUE)),
    dm_mn_all = round(sum(dm * wgt, na.rm = TRUE)),
    neuro_all = round(sum(neuro * wgt, na.rm = TRUE))) %>%
  filter(row_number() == 1) %>%
  ungroup()

# add study age, surg_nosurg, design
temp <- left_join(study_names, study_char.dat[, c("refid", "age", "surg_nosurg", "design")], by = "refid")
  
pt_char_table <- left_join(pt_char_table, temp, by = "refid") %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  mutate(study = ifelse(grepl("Marquini", study), str_c(study, "^a^"), study)) %>% 
  select(design, study, year, everything())

rm(temp)

pt_char_table <- pt_char_table %>% 
  # filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  select(study, N, asai_all, asaii_all, asai_ii_all, asaiii_all, sex_all, age_mn_all, 
  age_md_all, white_all, black_all, asian_all, bmi_mn_all, bmi_md_all, dm_mn_all)

```

```{r ptCharKable, echo = FALSE}
pt_char_table %>% 
  mutate_at(vars(asai_all:dm_mn_all), na_if, 0) %>% 
  kbl(
    booktabs = T, align = c("lrrrrcccccccccc"),
    col.names = c("\\ \\ \\ \\ \\ \\ \\ Study", "Analyzed", "I", "II", "I-II", "III", "(%)",
      "Mean", "Med", "White", "Black", "Asian", "Mean", "Med", "DM (%)")) %>%
  add_header_above(c(" " = 1, "N" = 1, "\\ \\ \\ ASA Classs (%)" = 4, "Female" = 1, "Age" = 2,
    "Race (%)" = 3, "BMI (kg/m^2^)" = 2, " " = 1), line = TRUE) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>%
  # column_spec(2, width = "4em") %>%
  column_spec(3, width = "3em") %>%
  pack_top(., "Adult, Surgical", 1, 19) %>% 
  pack_sub(., "RCT", 1, 19) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 20, 21) %>% 
  pack_sub(., "Retrospective Cohort", 22, 22) %>% 
  pack_top(., "Adult, Nonsurgical", 23, 23) %>% 
  pack_sub(., "RCT", 23, 23) %>%
  pack_sub(., "Crossover", 24, 29) %>%
  pack_top(., "Pediatric, Nonsurgical", 30, 30) %>% 
  pack_sub(., "RCT", 30, 30) %>% 
  footnote(alphabet = c("Multiple publications from he same study."),
    general = "Med: median",
    general_title = "",
    footnote_as_chunk = T
  )
table_n <- tab_inc()
```

<br><br>

## Fasting, Liquid Timing and Amounts 

<font size = 4> Table `r table_n`. Liquid consumption prior to surgery or outcome measurement and amounts according to study arm. </font>

```{r createFastingTable, include = FALSE}
fasting_table <- study_arm.dat %>% 
  filter(refid %in% protein_refids$refid) %>% 
  mutate(tx = str_replace(arm_tx, "_", " ")) %>% 
  mutate(tx = str_to_title(tx)) %>% 
  mutate(tx = if_else(tx == "Cho", "CHO", tx, "")) %>% 
  mutate(arm = ifelse(refid == 3588 & arm_n == 35, 3, arm),
         arm = ifelse(refid == 3588 & arm_n == 27, 2, arm)) %>% 
  select(refid, tx, arm_n, fastsolid, fastliquid, type_of_liquid, timeingest1, amtingest1, timeingest2, amtingest2, age, surg_nosurg, age, design, arm) 

fasting_table <- left_join(fasting_table, study_names, by = "refid") %>% 
  arrange(age, desc(surg_nosurg), design, year, study, arm) %>%
  select(study, year, design, 2:10) 

fasting_table <- fasting_table %>%
  mutate(tx = factor(tx,
    levels = c("Fasting", "Water", "Placebo", "Other Clear", "Prot/CHO", "CHO", "Milk", "Other"))) %>% 
  mutate(timeingest1 = ifelse(timeingest1 == 99, 12, timeingest1)) %>% 
  mutate(amtingest1  = na_if(amtingest1, 0)) %>% 
  mutate(timeingest1 = round(timeingest1, 0)) %>% 
  mutate(timeingest2 = round(timeingest2, 0)) %>% 
  group_by(study) %>% 
  # mutate(design = if_else(row_number() == 1, design, "")) %>% 
  mutate(year = ifelse(row_number() == 1, as.numeric(year), "" )) %>% 
  mutate(study = ifelse(study == "Marquini 2020a", "Marquini 2020a,b,c", study)) %>% 
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  mutate(study = if_else(row_number() == 1, study, ""))

# study arms
study_arm.dat %>% 
  filter(refid %in% protein_refids$refid) %>% 
  group_by(refid) %>% 
  count(refid)

```

```{r fastingKable, echo = FALSE}
fasting_table %>%
  select(-year, -design, -type_of_liquid) %>% 
  kbl(booktabs = T, align = c("llccccccc"),
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "\\ \\ Liquid", "N", "Solids", "Liquids",  "Time^a^ (hr)", "Amount (mL)", 
      "Time^a^ (hr)", "Amount (mL)")) %>%
  add_header_above(c(" " = 3, "Prescribed Fasting  (hr)" = 2, "Treat Liquid 1" = 2, "Treat Liquid 2" = 2), line = TRUE) %>% 
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>% 
  # column_spec(2, width = "5em") %>% 
  # column_spec(3, width = "9em") %>%
  pack_top(., "Adult, Surgical", 1, 44) %>% 
  pack_sub(., "RCT", 1, 44) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 45, 50) %>% 
  pack_sub(., "Retrospective Cohort", 51, 52) %>% 
  pack_top(., "Adult, Nonsurgical", 53, 68) %>% 
  pack_sub(., "RCT", 53, 54) %>%
  pack_sub(., "Crossover", 55, 68) %>%
  pack_top(., "Pediatric, Nonsurgical", 69, 71) %>% 
  pack_sub(., "RCT", 69, 71) %>%   
  footnote(general = "hr: hours",
          alphabet = c("Hours prior to surgery"),
          alphabet_title = " ",
          general_title = "",
          footnote_as_chunk = T)

table_n <- tab_inc()
```

<br><br>

## Protein-containing Drinks 

<font size = 4> Table `r table_n`. Composition of protein-containing liquids and brands. </font>

```{r createProteinDrinkTable, include = FALSE}
# protein drinks used
prot_drink.dat <- readxl::read_xlsx("data/protein_detail_102320.xlsx", range = "A28:O59") %>% 
  janitor::clean_names()

# calculate total protein
volume <- study_arm.dat %>% 
  filter(arm_tx == "protein") %>% 
  select(refid, study, year, arm_tx, arm, amtingest1, amtingest2) %>% 
  mutate(amtingest2 = replace_na(amtingest2, 0),
    tot_vol = amtingest2 + amtingest1)

temp <- left_join(study_names, study_char.dat[, c("refid", "age", "surg_nosurg", "design")], by = "refid")
prot_drink.dat <- left_join(prot_drink.dat, temp, by = "refid") 
rm(temp)
prot_drink.dat[, 5:10] <- map(prot_drink.dat[, 5:10], function(x) noquote(if_else(x == "X", "\U2022", "", "")))

prot_drink.dat <- left_join(prot_drink.dat, volume[, c("refid", "tot_vol")], by = "refid") %>% 
  mutate(prot_g_all = round(protein_g * tot_vol/100, 0))
         
prot_drink_table <- prot_drink.dat %>% 
  mutate(kcal = round(as.numeric(kcal), 0)) %>% 
  group_by(refid) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>% 
  mutate(study = ifelse(row_number() == 2, " ", study),
         study = ifelse(study == "Marquini 2020a", "Marquini 2020 (all)", study)) %>% 
  ungroup() %>% 
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  select(study, whey, glutamine, arginine, pea, soy, not_specified, protein_g, cho_g, kcal, osmolarity, prot_g_all, brand, tx_detail)
```

```{r proteinDrinksKable, echo = FALSE}
prot_drink_table %>% 
  select(-tx_detail) %>% 
  kbl(booktabs = T, align = c("lccccccccccc"),
      col.names = linebreak(c("\\ \\ \\ \\ \\ \\ \\ Author", "Whey", "Glut", "Arg", "Pea", "Soy", "NS", 
      "Protein, g", "CHO, g", "Kcal", "Osm", "Ingested, g", "Brand"))) %>%
  add_header_above(c(" " = 7, "Per 100 g" = 4, "Protein" = 1, " " = 1), line = TRUE) %>%  
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>% 
  column_spec(c(2,3,4,5,6,7), width = "3em") %>% 
  # column_spec(3, width = "9em") %>%
  pack_top(., "Adult, Surgical", 1, 17) %>% 
  pack_sub(., "RCT", 1, 17) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 18, 19) %>% 
  pack_sub(., "Retrospective Cohort", 20, 20) %>% 
  pack_top(., "Adult, Nonsurgical", 21, 28) %>% 
  pack_sub(., "RCT", 21, 21) %>%
  pack_sub(., "Crossover", 22, 28) %>%
  pack_top(., "Pediatric, Nonsurgical", 29, 29) %>% 
  pack_sub(., "RCT", 29, 29) %>%  
  footnote(general = "CHO: carbohydrate; g: grams; Osm: osomolality; Glut: glutamine; Arg: arginine; NS: not specified",
          #alphabet = c("per 100/mL if not otherwise specified"),
          # alphabet_title = " ",
          general_title = "",
          footnote_as_chunk = T)  

table_n <- tab_inc()
```

<br>

```{r proteinDrinksDetailKable, echo = FALSE, include = FALSE}
# Table `r table_n`. 
## Protein-containing Drinks (note) 
prot_drink_table %>% 
  select(study, tx_detail) %>% 
  filter(!is.na(tx_detail)) %>% 
   kbl(booktabs = T, align = c("ll"),
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "Detail")) %>%
  kable_classic(full_width = TRUE, html_font = "Cambria", position = "left", "striped") %>% 
  column_spec(1, width = "15em") %>% 
  # column_spec(2, width = "5em") %>% 
  # column_spec(3, width = "9em") %>%
  # add_header_above(c(" " = 3, "Prescribed Fasting  (hr)" = 2, "Treat Liquid 1" = 2, "Treat Liquid 2" = 2)) %>% 
  pack_rows("RCT", 1, 19) %>%
  pack_rows("Crossover", 20, 26) %>% 
  pack_rows("Non-randomized study (intervention)", 27, 28) %>% 
  pack_rows("Retrospective Cohort", 29, 29) %>% 
  footnote(general = "g: grams; Osm: osmolality",
          # alphabet = c("Hours prior to surgery"),
          # alphabet_title = " ",
          general_title = "",
          footnote_as_chunk = T)  
```

<br>

## Comparator Detail

<font size = 4> Table `r table_n`. Comparator details.</font>

```{r createComparatorDetailTable, echo = FALSE}

comparator_detail_table <- study_arm.dat %>%
  filter(refid %in% protein_refids$refid) %>%
  mutate(
    tx = str_replace(arm_tx, "_", " "),
    tx = str_to_title(tx),
    tx = if_else(tx == "Cho", "CHO", tx, ""),
    tx_detail = firstup(tx_detail),
    arm = ifelse(refid == 3588 & arm_n == 35, 3, arm),
    arm = ifelse(refid == 3588 & arm_n == 27, 2, arm)) %>%
  select(refid, arm_n, tx, type_of_liquid, tx_detail, arm)

temp <- left_join(study_names, study_char.dat[, c("refid", "age", "surg_nosurg", "design")], by = "refid")
comparator_detail_table <- left_join(comparator_detail_table, temp, by = "refid") %>% 
  arrange(age, desc(surg_nosurg), design, year, study, arm) %>%
  group_by(study)
rm(temp)

comparator_detail_table <- comparator_detail_table %>%
  mutate(tx = factor(tx,
    levels = c("Fasting", "Water", "Placebo", "Other Clear", "Prot/CHO", "CHO", "Milk", "Other"))) %>% 
  arrange(age, desc(surg_nosurg), design, year, study, arm) %>% 
  group_by(study) %>% 
  # mutate(design = if_else(row_number() == 1, design, "")) %>% 
  mutate(year = ifelse(row_number() == 1, as.numeric(year), "" )) %>% 
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  mutate(study = if_else(row_number() == 1, study, ""),
         study = ifelse(study == "Marquini 2020a", "Marquini 2020 (all)", study)) %>% 
  select(study, arm_n, tx, tx_detail)

```

```{r createComparatorDetailKable, echo = FALSE}
comparator_detail_table %>% 
   kbl(booktabs = T, align = c("ll"),
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "N", "Liquid", "Detail")) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "15em") %>% 
  column_spec(2, width = "5em") %>% 
  column_spec(3, width = "8em") %>%
  # add_header_above(c(" " = 3, "Prescribed Fasting  (hr)" = 2, "Treat Liquid 1" = 2, "Treat Liquid 2" = 2)) %>% 
  pack_top(., "Adult, Surgical", 1, 44) %>% 
  pack_sub(., "RCT", 1, 44) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 45, 50) %>% 
  pack_sub(., "Retrospective Cohort", 51, 52) %>% 
  pack_top(., "Adult, Nonsurgical", 53, 68) %>% 
  pack_sub(., "RCT", 53, 54) %>%
  pack_sub(., "Crossover", 55, 68) %>%
  pack_top(., "Pediatric, Nonsurgical", 69, 71) %>% 
  pack_sub(., "RCT", 69, 71) %>% 
  footnote(general = "CHO: carbohydrate; g: grams; Osm: osmolality",
          # alphabet = c("Hours prior to surgery"),
          # alphabet_title = " ",
          general_title = "",
          footnote_as_chunk = T)  

table_n <- tab_inc()
```

<br>

## Funding 

<font size = 4> Table `r table_n`. Reported funding sources. </font>

```{r createFundingTable, include = FALSE}
study_fund_table <- study_char_prot.dat %>%
  mutate(
    # sponsor_desc = str_to_title(sponsor_desc),
    registered = noquote(if_else(registered == "yes", "\U2022", "", "")),
    public = noquote(if_else(funding == "public" | funding == "pub_indus", "\U2022", "", "")),
    industry = noquote(if_else(funding == "pub_indus", "\U2022", "", "")),
    none = noquote(if_else(funding == "none", "\U2022", "", "")),
    not_reported = noquote(if_else(funding == "NR", "\U2022", "", "")),
    study = ifelse(study == "Marquini 2020a", "Marquini 2020 (all)", study)) %>%
  filter(!study %in% c("Marquini 2020b", "Marquini 2020c")) %>% 
  arrange(age, desc(surg_nosurg), design, year, study) %>%
  select(study, design, registered, public, industry, none, not_reported, sponsor_desc)

temp <- prot_drink_table %>% 
  mutate(brand = ifelse(str_detect(brand, "Arm"), NA, brand)) %>% 
  select(study, brand) %>% 
  distinct()

study_fund_table <- left_join(study_fund_table, temp, by = "study") 

```

```{r fundingKable, echo = FALSE}
study_fund_table %>% 
  select(-design, -registered) %>% 
  kbl(booktabs = T, align = c("lcccclll"),
      col.names = c("\\ \\ \\ \\ \\ \\ \\ Author", "Public", "Industry", "None", 
                    "Not Reported", "Funding description", "Brand")) %>%
  kable_classic(full_width = TRUE, html_font = opt_font, position = "left", "hover") %>% 
  kable_styling(bootstrap_options = opt_boot) %>% 
  column_spec(1, width = "16em") %>% 
  column_spec(c(2,3,4,5), width = "4em") %>% 
  column_spec(6, width = "23em") %>%
  add_header_above(c(" " = 1, "Reported Funding Source(s)" = 4, " " = 2), line = TRUE) %>% 
  # add_header_above(c(" " = 3, "Prescribed Fasting  (hr)" = 2, "Treat Liquid 1" = 2, "Treat Liquid 2" = 2)) %>% 
  # add_header_above(c(" " = 3, "Prescribed Fasting  (hr)" = 2, "Treat Liquid 1" = 2, "Treat Liquid 2" = 2)) %>% 
  pack_top(., "Adult, Surgical", 1, 17) %>% 
  pack_sub(., "RCT", 1, 17) %>% 
  pack_sub(., "Nonrandomized Studies of Interventions", 18, 19) %>% 
  pack_sub(., "Retrospective Cohort", 20, 20) %>% 
  pack_top(., "Adult, Nonsurgical", 21, 21) %>% 
  pack_sub(., "RCT", 21, 21) %>%
  pack_sub(., "Crossover", 22, 27) %>%
  pack_top(., "Pediatric, Nonsurgical", 28, 28) %>% 
  pack_sub(., "RCT", 28, 28)
  #footnote(general = "g: grams; Osm: osmolality",
          # alphabet = c("Hours prior to surgery"),
          # alphabet_title = " ",
          # general_title = "",
          # footnote_as_chunk = T)

table_n <- tab_inc()
```

<br>


<br>

# Risk of Bias 

### *Patient Reported Outcomes

<br>

<font size = 4> Figure `r figure_n`. Individual study risk of bias appraisal for randomized controlled trials including patient reported outcomes --- nausea, hunger, thirst, and pain. </font>

<img src="assets/hunger_dichot_rob_traffic.svg" style="width:600px;" align="left" />

<br clear="all" />

```{r}
figure_n <- fig_inc()
```

<br>

### Clinical Outcomes

<br>

<font size = 4> Figure `r figure_n`. Individual study risk of bias appraisal for randomized controlled trials for clinical outcomes. </font>


```{r}
figure_n <- fig_inc()
```

<br>

# References {#references}

